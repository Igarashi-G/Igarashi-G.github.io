<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://igarashi-g.github.io/database/MySQL/Mysql%E8%B0%83%E4%BC%98.html"><meta property="og:site_name" content="五十岚 ▪ 寄"><meta property="og:title" content="Mysql调优"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-12T14:58:07.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-10-12T14:58:07.000Z"><title>Mysql调优 | 五十岚 ▪ 寄</title><meta name="description" content="五十岚の博客">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.31ae6679.css">
    <link rel="modulepreload" href="/assets/app.4e18fb57.js"><link rel="modulepreload" href="/assets/Mysql调优.html.28700e34.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/Mysql调优.html.97e4f341.js"><link rel="prefetch" href="/assets/index.html.84515c4d.js"><link rel="prefetch" href="/assets/home.html.5a08a41a.js"><link rel="prefetch" href="/assets/intro.html.a3abc21e.js"><link rel="prefetch" href="/assets/slides.html.be530558.js"><link rel="prefetch" href="/assets/index.html.94e75599.js"><link rel="prefetch" href="/assets/index.html.2616f9e7.js"><link rel="prefetch" href="/assets/disable.html.e5c6b2d4.js"><link rel="prefetch" href="/assets/encrypt.html.a9dc5b86.js"><link rel="prefetch" href="/assets/markdown.html.6c71d675.js"><link rel="prefetch" href="/assets/page.html.420ce2a4.js"><link rel="prefetch" href="/assets/PS操作基础.html.f33208ce.js"><link rel="prefetch" href="/assets/index.html.3de1b61a.js"><link rel="prefetch" href="/assets/SAI操作基础.html.34f3130b.js"><link rel="prefetch" href="/assets/index.html.241f593a.js"><link rel="prefetch" href="/assets/index.html.5951c66f.js"><link rel="prefetch" href="/assets/asyncio_recipes.html.ebf94d80.js"><link rel="prefetch" href="/assets/devops_in_python.html.dfef3bf0.js"><link rel="prefetch" href="/assets/fluent_python.html.4e0ceb79.js"><link rel="prefetch" href="/assets/index.html.ee931f7a.js"><link rel="prefetch" href="/assets/python_cookbook.html.7019a229.js"><link rel="prefetch" href="/assets/python源码剖析.html.c7855182.js"><link rel="prefetch" href="/assets/use_asyncio.html.a14b57ff.js"><link rel="prefetch" href="/assets/index.html.bd5e83b6.js"><link rel="prefetch" href="/assets/亚动机与人格.html.3a368f30.js"><link rel="prefetch" href="/assets/人的潜能和价值.html.a0342cee.js"><link rel="prefetch" href="/assets/好人是如何变成恶魔的.html.24920c45.js"><link rel="prefetch" href="/assets/影响力.html.de751fba.js"><link rel="prefetch" href="/assets/性心理学.html.7d90e547.js"><link rel="prefetch" href="/assets/洗脑心理学.html.d0f71f8a.js"><link rel="prefetch" href="/assets/进化心理学.html.6eaa9043.js"><link rel="prefetch" href="/assets/CODE.html.3423e072.js"><link rel="prefetch" href="/assets/index.html.076c260e.js"><link rel="prefetch" href="/assets/成为技术领导者.html.416740ca.js"><link rel="prefetch" href="/assets/鸟哥的Linux私房菜.html.313b2073.js"><link rel="prefetch" href="/assets/鸟哥的Linux私房菜服务器架设篇.html.8a6ebb9f.js"><link rel="prefetch" href="/assets/黑客与画家.html.c51996a7.js"><link rel="prefetch" href="/assets/index.html.cf0592b7.js"><link rel="prefetch" href="/assets/中国人的性格.html.7351181c.js"><link rel="prefetch" href="/assets/乌合之众.html.6ae759af.js"><link rel="prefetch" href="/assets/娱乐至死.html.9ea40086.js"><link rel="prefetch" href="/assets/index.html.cbca1670.js"><link rel="prefetch" href="/assets/清醒思考的艺术.html.13bdcbad.js"><link rel="prefetch" href="/assets/index.html.e3b7c376.js"><link rel="prefetch" href="/assets/博弈论与经济行为.html.dc5050ce.js"><link rel="prefetch" href="/assets/就业_利息和货币通论.html.d5958861.js"><link rel="prefetch" href="/assets/聪明的投资者.html.af08bc8d.js"><link rel="prefetch" href="/assets/货币金融学.html.6ad25057.js"><link rel="prefetch" href="/assets/非理性繁荣.html.3f3d5cb2.js"><link rel="prefetch" href="/assets/MySQL.html.e388cdc4.js"><link rel="prefetch" href="/assets/Mysql进阶.html.27f9908e.js"><link rel="prefetch" href="/assets/Mysql高阶.html.383f9ec6.js"><link rel="prefetch" href="/assets/Navicat.html.b57adb1b.js"><link rel="prefetch" href="/assets/SQLAlchemy.html.05704fc2.js"><link rel="prefetch" href="/assets/PostgreSQL.html.b489b540.js"><link rel="prefetch" href="/assets/redis.html.60d74794.js"><link rel="prefetch" href="/assets/性能分析.html.56438664.js"><link rel="prefetch" href="/assets/aioetcd3.html.9a68abb5.js"><link rel="prefetch" href="/assets/etcd.html.7f601ff8.js"><link rel="prefetch" href="/assets/进阶.html.74a14dae.js"><link rel="prefetch" href="/assets/go语言速记.html.b114508d.js"><link rel="prefetch" href="/assets/docker容器.html.789e680f.js"><link rel="prefetch" href="/assets/使用基础.html.56406bb9.js"><link rel="prefetch" href="/assets/命令.html.cc326fd5.js"><link rel="prefetch" href="/assets/网络.html.20accbae.js"><link rel="prefetch" href="/assets/GIt提交规则.html.b61995d7.js"><link rel="prefetch" href="/assets/Git.html.0d5fce44.js"><link rel="prefetch" href="/assets/安装GitLab.html.64dc66fd.js"><link rel="prefetch" href="/assets/k8s安装.html.f345126e.js"><link rel="prefetch" href="/assets/k8s工作负载.html.3e3d7dbe.js"><link rel="prefetch" href="/assets/k8s服务.html.310833cd.js"><link rel="prefetch" href="/assets/k8s资源Pod.html.1083c626.js"><link rel="prefetch" href="/assets/k8s进阶.html.9f8285c9.js"><link rel="prefetch" href="/assets/Nginx基础.html.882aead1.js"><link rel="prefetch" href="/assets/应用部署.html.d3cba08a.js"><link rel="prefetch" href="/assets/Fiddler抓包工具.html.2e0eaa4e.js"><link rel="prefetch" href="/assets/Postman.html.ab4864db.js"><link rel="prefetch" href="/assets/Screen.html.d5a3041f.js"><link rel="prefetch" href="/assets/rdesktop.html.920ddeb3.js"><link rel="prefetch" href="/assets/tmux.html.02a7fcb6.js"><link rel="prefetch" href="/assets/网络代理.html.ec01359e.js"><link rel="prefetch" href="/assets/APScheduler.html.263f1926.js"><link rel="prefetch" href="/assets/Celery.html.13320b39.js"><link rel="prefetch" href="/assets/Celery使用基础.html.cda56b19.js"><link rel="prefetch" href="/assets/异步任务概述.html.22435050.js"><link rel="prefetch" href="/assets/RabbitMQ.html.4cc2d825.js"><link rel="prefetch" href="/assets/kafka.html.f0317fdf.js"><link rel="prefetch" href="/assets/RPC.html.5e382878.js"><link rel="prefetch" href="/assets/gRPC.html.7d04590d.js"><link rel="prefetch" href="/assets/asyncio Recipes.html.8e28c2d4.js"><link rel="prefetch" href="/assets/asyncio基础.html.967262da.js"><link rel="prefetch" href="/assets/asyncio进阶.html.f9a79d6d.js"><link rel="prefetch" href="/assets/事件循环.html.ccc0dca2.js"><link rel="prefetch" href="/assets/底层实现.html.948a7f68.js"><link rel="prefetch" href="/assets/异步回溯.html.19a9e196.js"><link rel="prefetch" href="/assets/pip.html.786da363.js"><link rel="prefetch" href="/assets/字符编码.html.62c5c8ab.js"><link rel="prefetch" href="/assets/数据类型.html.8611832a.js"><link rel="prefetch" href="/assets/文件基础.html.8b023d93.js"><link rel="prefetch" href="/assets/流程控制.html.d185267c.js"><link rel="prefetch" href="/assets/环境安装.html.0a3744ab.js"><link rel="prefetch" href="/assets/协程.html.c4604095.js"><link rel="prefetch" href="/assets/同步队列.html.8a638e16.js"><link rel="prefetch" href="/assets/多线程编程.html.b6a1d1fe.js"><link rel="prefetch" href="/assets/多进程编程.html.fc59ec56.js"><link rel="prefetch" href="/assets/线程.html.6b48a511.js"><link rel="prefetch" href="/assets/线程进程辅助机制.html.bfd51d9e.js"><link rel="prefetch" href="/assets/进程.html.638192b5.js"><link rel="prefetch" href="/assets/Cpython对象.html.e63dd9d4.js"><link rel="prefetch" href="/assets/垃圾回收.html.c0f20ca3.js"><link rel="prefetch" href="/assets/序列进阶.html.2d06813a.js"><link rel="prefetch" href="/assets/映射进阶.html.2b995404.js"><link rel="prefetch" href="/assets/设计模式.html.d23369e7.js"><link rel="prefetch" href="/assets/Socket.html.48f0d65b.js"><link rel="prefetch" href="/assets/Websocket.html.2184fee7.js"><link rel="prefetch" href="/assets/事件模型.html.87334d53.js"><link rel="prefetch" href="/assets/回调.html.fa7100b8.js"><link rel="prefetch" href="/assets/函数.html.98eca835.js"><link rel="prefetch" href="/assets/变量机制.html.a5c01f07.js"><link rel="prefetch" href="/assets/模块和包.html.f7126264.js"><link rel="prefetch" href="/assets/生成器.html.bbc3e2b6.js"><link rel="prefetch" href="/assets/装饰器.html.c196db44.js"><link rel="prefetch" href="/assets/迭代器.html.82a222fb.js"><link rel="prefetch" href="/assets/错误和异常.html.1fd3fea1.js"><link rel="prefetch" href="/assets/面向对象.html.aad02caa.js"><link rel="prefetch" href="/assets/DNS服务.html.eed32b92.js"><link rel="prefetch" href="/assets/bind.html.4d359edc.js"><link rel="prefetch" href="/assets/linux 文件锁.html.e18e8d20.js"><link rel="prefetch" href="/assets/脚本说明.html.8f656de9.js"><link rel="prefetch" href="/assets/AD域.html.1b000bfd.js"><link rel="prefetch" href="/assets/LDAP.html.6b72d1f8.js"><link rel="prefetch" href="/assets/Python对接AD域.html.ad08d2bd.js"><link rel="prefetch" href="/assets/NFS服务.html.bf70ba65.js"><link rel="prefetch" href="/assets/NTP服务.html.aae0cea3.js"><link rel="prefetch" href="/assets/SNMP服务.html.d0a8f318.js"><link rel="prefetch" href="/assets/Samba服务.html.9761e33c.js"><link rel="prefetch" href="/assets/ufscli工具.html.2202541c.js"><link rel="prefetch" href="/assets/ufs核心组件.html.3038dfb8.js"><link rel="prefetch" href="/assets/ufs管理平台.html.5955fdb4.js"><link rel="prefetch" href="/assets/uus虚拟机排错.html.c191ab65.js"><link rel="prefetch" href="/assets/CentOS的安装.html.c88ee896.js"><link rel="prefetch" href="/assets/RPM包管理.html.f8c286d2.js"><link rel="prefetch" href="/assets/账号管理与ACL权限.html.45629df2.js"><link rel="prefetch" href="/assets/Linux是什么与如何学习.html.42f1edf5.js"><link rel="prefetch" href="/assets/主机规划与磁盘分区.html.e98f9782.js"><link rel="prefetch" href="/assets/计算机概论.html.8b78efb5.js"><link rel="prefetch" href="/assets/Linux磁盘与文件系统管理.html.f2e83970.js"><link rel="prefetch" href="/assets/文件与文件系统压缩.html.fbe9151b.js"><link rel="prefetch" href="/assets/文件权限与目录配置.html.1345de0d.js"><link rel="prefetch" href="/assets/认识系统服务.html.b0a77c03.js"><link rel="prefetch" href="/assets/vim 快捷键.html.8fb26319.js"><link rel="prefetch" href="/assets/vim程序编辑器.html.653dc7c5.js"><link rel="prefetch" href="/assets/常复习.html.5f762ed9.js"><link rel="prefetch" href="/assets/CURL.html.a58ba046.js"><link rel="prefetch" href="/assets/SSL协议.html.a0b3818a.js"><link rel="prefetch" href="/assets/命令.html.c0818570.js"><link rel="prefetch" href="/assets/网络基础.html.3f0d2ad9.js"><link rel="prefetch" href="/assets/Ubuntu系列操作.html.2d3284d7.js"><link rel="prefetch" href="/assets/认识Linux系统.html.92fbea05.js"><link rel="prefetch" href="/assets/CPU.html.624ffdd7.js"><link rel="prefetch" href="/assets/主板.html.eba6fab1.js"><link rel="prefetch" href="/assets/内存.html.f4a9bfa2.js"><link rel="prefetch" href="/assets/存储.html.7c0b40ac.js"><link rel="prefetch" href="/assets/扩展卡与接口.html.20ee9dfd.js"><link rel="prefetch" href="/assets/显卡.html.c6223e27.js"><link rel="prefetch" href="/assets/PVE.html.8fcfa6f1.js"><link rel="prefetch" href="/assets/添加磁盘.html.d7dd97c0.js"><link rel="prefetch" href="/assets/网络配置.html.3ea84e90.js"><link rel="prefetch" href="/assets/404.html.19a9275b.js"><link rel="prefetch" href="/assets/index.html.02b98117.js"><link rel="prefetch" href="/assets/index.html.870d4e9a.js"><link rel="prefetch" href="/assets/index.html.412710b6.js"><link rel="prefetch" href="/assets/index.html.9ee6b029.js"><link rel="prefetch" href="/assets/index.html.f3068f3a.js"><link rel="prefetch" href="/assets/index.html.b3a4f791.js"><link rel="prefetch" href="/assets/index.html.1056e0a4.js"><link rel="prefetch" href="/assets/index.html.31a36b3e.js"><link rel="prefetch" href="/assets/index.html.4e1002d7.js"><link rel="prefetch" href="/assets/index.html.01c4efbe.js"><link rel="prefetch" href="/assets/index.html.45ee99c8.js"><link rel="prefetch" href="/assets/index.html.874a5c84.js"><link rel="prefetch" href="/assets/index.html.4533878d.js"><link rel="prefetch" href="/assets/index.html.8af94d91.js"><link rel="prefetch" href="/assets/index.html.d43aa8c3.js"><link rel="prefetch" href="/assets/index.html.0b7b82ea.js"><link rel="prefetch" href="/assets/index.html.3d4d77df.js"><link rel="prefetch" href="/assets/index.html.8e4c790e.js"><link rel="prefetch" href="/assets/index.html.6bda7342.js"><link rel="prefetch" href="/assets/index.html.88e2aac2.js"><link rel="prefetch" href="/assets/index.html.6ce24497.js"><link rel="prefetch" href="/assets/index.html.f72678dd.js"><link rel="prefetch" href="/assets/index.html.618bf277.js"><link rel="prefetch" href="/assets/index.html.d4f7c8f9.js"><link rel="prefetch" href="/assets/index.html.5aaa2dd5.js"><link rel="prefetch" href="/assets/index.html.453514a6.js"><link rel="prefetch" href="/assets/index.html.4e6cdf36.js"><link rel="prefetch" href="/assets/index.html.5da75686.js"><link rel="prefetch" href="/assets/index.html.3d48d8f9.js"><link rel="prefetch" href="/assets/index.html.dbdaad5d.js"><link rel="prefetch" href="/assets/index.html.5007e26a.js"><link rel="prefetch" href="/assets/index.html.b9a27fd4.js"><link rel="prefetch" href="/assets/index.html.a9eea0b5.js"><link rel="prefetch" href="/assets/index.html.f1f3922c.js"><link rel="prefetch" href="/assets/index.html.0784e604.js"><link rel="prefetch" href="/assets/index.html.ec6d48d5.js"><link rel="prefetch" href="/assets/index.html.b8ea12bb.js"><link rel="prefetch" href="/assets/index.html.44dbc329.js"><link rel="prefetch" href="/assets/index.html.06bf30d7.js"><link rel="prefetch" href="/assets/index.html.4a730a25.js"><link rel="prefetch" href="/assets/index.html.c7b03af4.js"><link rel="prefetch" href="/assets/index.html.602b6388.js"><link rel="prefetch" href="/assets/index.html.f78500e1.js"><link rel="prefetch" href="/assets/index.html.92daadff.js"><link rel="prefetch" href="/assets/index.html.139eb784.js"><link rel="prefetch" href="/assets/index.html.eaecfcd4.js"><link rel="prefetch" href="/assets/index.html.ca07c027.js"><link rel="prefetch" href="/assets/index.html.58081c32.js"><link rel="prefetch" href="/assets/index.html.767c76a9.js"><link rel="prefetch" href="/assets/index.html.e08cba86.js"><link rel="prefetch" href="/assets/index.html.d659acd3.js"><link rel="prefetch" href="/assets/index.html.57f0932f.js"><link rel="prefetch" href="/assets/index.html.697fb868.js"><link rel="prefetch" href="/assets/index.html.1de089f2.js"><link rel="prefetch" href="/assets/index.html.1af47f8e.js"><link rel="prefetch" href="/assets/index.html.4b6c4718.js"><link rel="prefetch" href="/assets/index.html.c91236b5.js"><link rel="prefetch" href="/assets/index.html.37209720.js"><link rel="prefetch" href="/assets/index.html.a6c3c8ce.js"><link rel="prefetch" href="/assets/index.html.1da6b71a.js"><link rel="prefetch" href="/assets/index.html.065bcbcd.js"><link rel="prefetch" href="/assets/index.html.5e8e94aa.js"><link rel="prefetch" href="/assets/index.html.6816f1eb.js"><link rel="prefetch" href="/assets/index.html.38c68190.js"><link rel="prefetch" href="/assets/index.html.076dbb4d.js"><link rel="prefetch" href="/assets/home.html.fddb51eb.js"><link rel="prefetch" href="/assets/intro.html.2b875527.js"><link rel="prefetch" href="/assets/slides.html.c41530a7.js"><link rel="prefetch" href="/assets/index.html.da060733.js"><link rel="prefetch" href="/assets/index.html.c7b4d438.js"><link rel="prefetch" href="/assets/disable.html.cf1aea15.js"><link rel="prefetch" href="/assets/encrypt.html.3edb34f6.js"><link rel="prefetch" href="/assets/markdown.html.2a60aaad.js"><link rel="prefetch" href="/assets/page.html.0f198abc.js"><link rel="prefetch" href="/assets/PS操作基础.html.8fb0eb7b.js"><link rel="prefetch" href="/assets/index.html.c2d89540.js"><link rel="prefetch" href="/assets/SAI操作基础.html.60cd371c.js"><link rel="prefetch" href="/assets/index.html.5e9a2747.js"><link rel="prefetch" href="/assets/index.html.50eead56.js"><link rel="prefetch" href="/assets/asyncio_recipes.html.294b1b04.js"><link rel="prefetch" href="/assets/devops_in_python.html.b2dd624a.js"><link rel="prefetch" href="/assets/fluent_python.html.203b9958.js"><link rel="prefetch" href="/assets/index.html.d06a1ea3.js"><link rel="prefetch" href="/assets/python_cookbook.html.0ef391a3.js"><link rel="prefetch" href="/assets/python源码剖析.html.2d43465b.js"><link rel="prefetch" href="/assets/use_asyncio.html.fa7dae1d.js"><link rel="prefetch" href="/assets/index.html.d0e31442.js"><link rel="prefetch" href="/assets/亚动机与人格.html.86fb77aa.js"><link rel="prefetch" href="/assets/人的潜能和价值.html.1e583cc0.js"><link rel="prefetch" href="/assets/好人是如何变成恶魔的.html.0da26197.js"><link rel="prefetch" href="/assets/影响力.html.2c9686ff.js"><link rel="prefetch" href="/assets/性心理学.html.d0153d68.js"><link rel="prefetch" href="/assets/洗脑心理学.html.e7df1fe5.js"><link rel="prefetch" href="/assets/进化心理学.html.11c47460.js"><link rel="prefetch" href="/assets/CODE.html.8f1ddc8e.js"><link rel="prefetch" href="/assets/index.html.8ec17788.js"><link rel="prefetch" href="/assets/成为技术领导者.html.6933fa94.js"><link rel="prefetch" href="/assets/鸟哥的Linux私房菜.html.9334b519.js"><link rel="prefetch" href="/assets/鸟哥的Linux私房菜服务器架设篇.html.8a714673.js"><link rel="prefetch" href="/assets/黑客与画家.html.231d434d.js"><link rel="prefetch" href="/assets/index.html.bf8068eb.js"><link rel="prefetch" href="/assets/中国人的性格.html.0639c5c5.js"><link rel="prefetch" href="/assets/乌合之众.html.acb99725.js"><link rel="prefetch" href="/assets/娱乐至死.html.692865e1.js"><link rel="prefetch" href="/assets/index.html.308de27b.js"><link rel="prefetch" href="/assets/清醒思考的艺术.html.26e1b1dd.js"><link rel="prefetch" href="/assets/index.html.5891940f.js"><link rel="prefetch" href="/assets/博弈论与经济行为.html.36c2a347.js"><link rel="prefetch" href="/assets/就业_利息和货币通论.html.ed2c1f19.js"><link rel="prefetch" href="/assets/聪明的投资者.html.09c0e310.js"><link rel="prefetch" href="/assets/货币金融学.html.a1b105ae.js"><link rel="prefetch" href="/assets/非理性繁荣.html.96ae2146.js"><link rel="prefetch" href="/assets/MySQL.html.a4d7eb2e.js"><link rel="prefetch" href="/assets/Mysql进阶.html.223a5ac9.js"><link rel="prefetch" href="/assets/Mysql高阶.html.cc2ad23e.js"><link rel="prefetch" href="/assets/Navicat.html.792bb83b.js"><link rel="prefetch" href="/assets/SQLAlchemy.html.62441ccf.js"><link rel="prefetch" href="/assets/PostgreSQL.html.6792bbe4.js"><link rel="prefetch" href="/assets/redis.html.43036e49.js"><link rel="prefetch" href="/assets/性能分析.html.ba0847e3.js"><link rel="prefetch" href="/assets/aioetcd3.html.16163452.js"><link rel="prefetch" href="/assets/etcd.html.b0c63c93.js"><link rel="prefetch" href="/assets/进阶.html.43266e43.js"><link rel="prefetch" href="/assets/go语言速记.html.563f8373.js"><link rel="prefetch" href="/assets/docker容器.html.39b92f5f.js"><link rel="prefetch" href="/assets/使用基础.html.b72b8951.js"><link rel="prefetch" href="/assets/命令.html.b2a10e27.js"><link rel="prefetch" href="/assets/网络.html.f8c51779.js"><link rel="prefetch" href="/assets/GIt提交规则.html.4ed02df8.js"><link rel="prefetch" href="/assets/Git.html.2d14dfbf.js"><link rel="prefetch" href="/assets/安装GitLab.html.b357fc9a.js"><link rel="prefetch" href="/assets/k8s安装.html.2b9a299f.js"><link rel="prefetch" href="/assets/k8s工作负载.html.f6fd42b8.js"><link rel="prefetch" href="/assets/k8s服务.html.082d4316.js"><link rel="prefetch" href="/assets/k8s资源Pod.html.5208c900.js"><link rel="prefetch" href="/assets/k8s进阶.html.6fca0a76.js"><link rel="prefetch" href="/assets/Nginx基础.html.22c5e843.js"><link rel="prefetch" href="/assets/应用部署.html.902f0f90.js"><link rel="prefetch" href="/assets/Fiddler抓包工具.html.c2a1a6e6.js"><link rel="prefetch" href="/assets/Postman.html.9e4af1f4.js"><link rel="prefetch" href="/assets/Screen.html.430a2efb.js"><link rel="prefetch" href="/assets/rdesktop.html.cf7d8177.js"><link rel="prefetch" href="/assets/tmux.html.949fadd5.js"><link rel="prefetch" href="/assets/网络代理.html.f080a740.js"><link rel="prefetch" href="/assets/APScheduler.html.01689c63.js"><link rel="prefetch" href="/assets/Celery.html.afe5d404.js"><link rel="prefetch" href="/assets/Celery使用基础.html.54bdfe63.js"><link rel="prefetch" href="/assets/异步任务概述.html.698f93ea.js"><link rel="prefetch" href="/assets/RabbitMQ.html.693addf9.js"><link rel="prefetch" href="/assets/kafka.html.f4ffa26f.js"><link rel="prefetch" href="/assets/RPC.html.c2f84347.js"><link rel="prefetch" href="/assets/gRPC.html.cac2ac1c.js"><link rel="prefetch" href="/assets/asyncio Recipes.html.ace17ac4.js"><link rel="prefetch" href="/assets/asyncio基础.html.c1f1a547.js"><link rel="prefetch" href="/assets/asyncio进阶.html.bf42c3f5.js"><link rel="prefetch" href="/assets/事件循环.html.4c7d906a.js"><link rel="prefetch" href="/assets/底层实现.html.fd6ff7d2.js"><link rel="prefetch" href="/assets/异步回溯.html.f81ff771.js"><link rel="prefetch" href="/assets/pip.html.cce0ad03.js"><link rel="prefetch" href="/assets/字符编码.html.513eb9c9.js"><link rel="prefetch" href="/assets/数据类型.html.d31724d4.js"><link rel="prefetch" href="/assets/文件基础.html.65d4a049.js"><link rel="prefetch" href="/assets/流程控制.html.ac557a20.js"><link rel="prefetch" href="/assets/环境安装.html.51e1faa8.js"><link rel="prefetch" href="/assets/协程.html.4607b3de.js"><link rel="prefetch" href="/assets/同步队列.html.3496cc97.js"><link rel="prefetch" href="/assets/多线程编程.html.2091bc06.js"><link rel="prefetch" href="/assets/多进程编程.html.8730a503.js"><link rel="prefetch" href="/assets/线程.html.5f6f7f3c.js"><link rel="prefetch" href="/assets/线程进程辅助机制.html.46f7020e.js"><link rel="prefetch" href="/assets/进程.html.20957357.js"><link rel="prefetch" href="/assets/Cpython对象.html.c9f8f421.js"><link rel="prefetch" href="/assets/垃圾回收.html.d357f87c.js"><link rel="prefetch" href="/assets/序列进阶.html.9f681154.js"><link rel="prefetch" href="/assets/映射进阶.html.4c8b7839.js"><link rel="prefetch" href="/assets/设计模式.html.fb278ef1.js"><link rel="prefetch" href="/assets/Socket.html.3485dc88.js"><link rel="prefetch" href="/assets/Websocket.html.09b538d7.js"><link rel="prefetch" href="/assets/事件模型.html.707f6f23.js"><link rel="prefetch" href="/assets/回调.html.eaa3447e.js"><link rel="prefetch" href="/assets/函数.html.dccde2b5.js"><link rel="prefetch" href="/assets/变量机制.html.d1778e6c.js"><link rel="prefetch" href="/assets/模块和包.html.da5dc940.js"><link rel="prefetch" href="/assets/生成器.html.413ff80d.js"><link rel="prefetch" href="/assets/装饰器.html.ccb945a3.js"><link rel="prefetch" href="/assets/迭代器.html.851a77c7.js"><link rel="prefetch" href="/assets/错误和异常.html.af4569bc.js"><link rel="prefetch" href="/assets/面向对象.html.c094198e.js"><link rel="prefetch" href="/assets/DNS服务.html.7ad26ebc.js"><link rel="prefetch" href="/assets/bind.html.d6d00c0d.js"><link rel="prefetch" href="/assets/linux 文件锁.html.ec9f22c6.js"><link rel="prefetch" href="/assets/脚本说明.html.9a1083d6.js"><link rel="prefetch" href="/assets/AD域.html.83ab1915.js"><link rel="prefetch" href="/assets/LDAP.html.8e532e71.js"><link rel="prefetch" href="/assets/Python对接AD域.html.24b6f9f3.js"><link rel="prefetch" href="/assets/NFS服务.html.26ce14d9.js"><link rel="prefetch" href="/assets/NTP服务.html.e5118a46.js"><link rel="prefetch" href="/assets/SNMP服务.html.522ae9f2.js"><link rel="prefetch" href="/assets/Samba服务.html.4dc4da5a.js"><link rel="prefetch" href="/assets/ufscli工具.html.48cb280f.js"><link rel="prefetch" href="/assets/ufs核心组件.html.3a237d1e.js"><link rel="prefetch" href="/assets/ufs管理平台.html.a23c02fb.js"><link rel="prefetch" href="/assets/uus虚拟机排错.html.3a906404.js"><link rel="prefetch" href="/assets/CentOS的安装.html.b1f433ad.js"><link rel="prefetch" href="/assets/RPM包管理.html.5c674bc1.js"><link rel="prefetch" href="/assets/账号管理与ACL权限.html.3e42daab.js"><link rel="prefetch" href="/assets/Linux是什么与如何学习.html.e082588a.js"><link rel="prefetch" href="/assets/主机规划与磁盘分区.html.6d56164f.js"><link rel="prefetch" href="/assets/计算机概论.html.9050aeba.js"><link rel="prefetch" href="/assets/Linux磁盘与文件系统管理.html.0eda797a.js"><link rel="prefetch" href="/assets/文件与文件系统压缩.html.3c5dd9f9.js"><link rel="prefetch" href="/assets/文件权限与目录配置.html.cb6206b7.js"><link rel="prefetch" href="/assets/认识系统服务.html.8315ee74.js"><link rel="prefetch" href="/assets/vim 快捷键.html.d1c37215.js"><link rel="prefetch" href="/assets/vim程序编辑器.html.0dad06ac.js"><link rel="prefetch" href="/assets/常复习.html.57937c24.js"><link rel="prefetch" href="/assets/CURL.html.bb77545b.js"><link rel="prefetch" href="/assets/SSL协议.html.3f1d310e.js"><link rel="prefetch" href="/assets/命令.html.3a2d0615.js"><link rel="prefetch" href="/assets/网络基础.html.20c8c8ba.js"><link rel="prefetch" href="/assets/Ubuntu系列操作.html.74b9c9c3.js"><link rel="prefetch" href="/assets/认识Linux系统.html.10677fb9.js"><link rel="prefetch" href="/assets/CPU.html.a1ec9079.js"><link rel="prefetch" href="/assets/主板.html.a2728989.js"><link rel="prefetch" href="/assets/内存.html.5fba95ed.js"><link rel="prefetch" href="/assets/存储.html.15959ae3.js"><link rel="prefetch" href="/assets/扩展卡与接口.html.60bc7fbc.js"><link rel="prefetch" href="/assets/显卡.html.35d956ee.js"><link rel="prefetch" href="/assets/PVE.html.05ff2dc9.js"><link rel="prefetch" href="/assets/添加磁盘.html.7590fae4.js"><link rel="prefetch" href="/assets/网络配置.html.b0a10052.js"><link rel="prefetch" href="/assets/404.html.c975fdec.js"><link rel="prefetch" href="/assets/index.html.4305ee4d.js"><link rel="prefetch" href="/assets/index.html.83ada5c9.js"><link rel="prefetch" href="/assets/index.html.a3521ad3.js"><link rel="prefetch" href="/assets/index.html.f3608013.js"><link rel="prefetch" href="/assets/index.html.b85a5e49.js"><link rel="prefetch" href="/assets/index.html.83f84bd5.js"><link rel="prefetch" href="/assets/index.html.afd4bacb.js"><link rel="prefetch" href="/assets/index.html.72ec0a1b.js"><link rel="prefetch" href="/assets/index.html.4720e17f.js"><link rel="prefetch" href="/assets/index.html.5cccca49.js"><link rel="prefetch" href="/assets/index.html.8e1b8984.js"><link rel="prefetch" href="/assets/index.html.7b07a1d1.js"><link rel="prefetch" href="/assets/index.html.97d5db6d.js"><link rel="prefetch" href="/assets/index.html.8f60c31a.js"><link rel="prefetch" href="/assets/index.html.58c703d9.js"><link rel="prefetch" href="/assets/index.html.98d0bdf9.js"><link rel="prefetch" href="/assets/index.html.08f5b79b.js"><link rel="prefetch" href="/assets/index.html.37d601af.js"><link rel="prefetch" href="/assets/index.html.df9174ac.js"><link rel="prefetch" href="/assets/index.html.0f81593f.js"><link rel="prefetch" href="/assets/index.html.907ef0c0.js"><link rel="prefetch" href="/assets/index.html.cd31b5dd.js"><link rel="prefetch" href="/assets/index.html.a1a118cb.js"><link rel="prefetch" href="/assets/index.html.709bf41a.js"><link rel="prefetch" href="/assets/index.html.165f3e94.js"><link rel="prefetch" href="/assets/index.html.eaee5626.js"><link rel="prefetch" href="/assets/index.html.5ffd4af6.js"><link rel="prefetch" href="/assets/index.html.9a8534cf.js"><link rel="prefetch" href="/assets/index.html.946d1037.js"><link rel="prefetch" href="/assets/index.html.7706ddaf.js"><link rel="prefetch" href="/assets/index.html.db586ec8.js"><link rel="prefetch" href="/assets/index.html.54ec4728.js"><link rel="prefetch" href="/assets/index.html.b9a3f387.js"><link rel="prefetch" href="/assets/index.html.b731c2fc.js"><link rel="prefetch" href="/assets/index.html.0f9a286e.js"><link rel="prefetch" href="/assets/index.html.9ccb50c8.js"><link rel="prefetch" href="/assets/index.html.79ac907d.js"><link rel="prefetch" href="/assets/index.html.d128631c.js"><link rel="prefetch" href="/assets/index.html.4e8d3eeb.js"><link rel="prefetch" href="/assets/index.html.6ca29705.js"><link rel="prefetch" href="/assets/index.html.b96344f7.js"><link rel="prefetch" href="/assets/index.html.6d30772b.js"><link rel="prefetch" href="/assets/index.html.ee838dcf.js"><link rel="prefetch" href="/assets/index.html.f8f3975d.js"><link rel="prefetch" href="/assets/index.html.87ea6f43.js"><link rel="prefetch" href="/assets/index.html.22d99d5d.js"><link rel="prefetch" href="/assets/index.html.4f9272ef.js"><link rel="prefetch" href="/assets/index.html.614a5c1b.js"><link rel="prefetch" href="/assets/index.html.e238e8b5.js"><link rel="prefetch" href="/assets/index.html.9272c7b7.js"><link rel="prefetch" href="/assets/index.html.4e28c20d.js"><link rel="prefetch" href="/assets/index.html.2a4572d5.js"><link rel="prefetch" href="/assets/index.html.57b6cb35.js"><link rel="prefetch" href="/assets/index.html.cac0b6ad.js"><link rel="prefetch" href="/assets/index.html.9e780931.js"><link rel="prefetch" href="/assets/index.html.73344312.js"><link rel="prefetch" href="/assets/index.html.947a7be6.js"><link rel="prefetch" href="/assets/index.html.3668b51c.js"><link rel="prefetch" href="/assets/index.html.34ad45e3.js"><link rel="prefetch" href="/assets/index.html.380e1403.js"><link rel="prefetch" href="/assets/index.html.319a5368.js"><link rel="prefetch" href="/assets/index.html.9187ec91.js"><link rel="prefetch" href="/assets/index.html.ecdc939d.js"><link rel="prefetch" href="/assets/index.html.2758e725.js"><link rel="prefetch" href="/assets/giscus.e34d3fcc.js"><link rel="prefetch" href="/assets/auto.56c9cb2e.js"><link rel="prefetch" href="/assets/index.1f644ee1.js"><link rel="prefetch" href="/assets/flowchart.parse.1479ec3f.js"><link rel="prefetch" href="/assets/mermaid.esm.min.0e041931.js"><link rel="prefetch" href="/assets/highlight.esm.9b852bc5.js"><link rel="prefetch" href="/assets/markdown.esm.77e8db25.js"><link rel="prefetch" href="/assets/math.esm.cb9d4be3.js"><link rel="prefetch" href="/assets/notes.esm.62c5f19d.js"><link rel="prefetch" href="/assets/reveal.esm.41ec5d7f.js"><link rel="prefetch" href="/assets/search.esm.04894411.js"><link rel="prefetch" href="/assets/zoom.esm.78977eba.js"><link rel="prefetch" href="/assets/VuePlayground.4e7b9683.js"><link rel="prefetch" href="/assets/photoswipe.esm.f594e77b.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/avatar.jpg" alt="五十岚 ▪ 寄"><!----><span class="site-name hide-in-pad">五十岚 ▪ 寄</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home"></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Python"><span class="title"><span class="icon iconfont icon-python"></span>Python</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>语言</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/python/%E8%AF%AD%E8%A8%80/%E5%9F%BA%E7%A1%80/%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85.html" class="nav-link" aria-label="基础"><!---->基础<!----></a></li><li class="dropdown-subitem"><a href="/python/%E8%AF%AD%E8%A8%80/%E8%BF%9B%E9%98%B6/%E5%8F%98%E9%87%8F%E6%9C%BA%E5%88%B6.html" class="nav-link" aria-label="进阶"><!---->进阶<!----></a></li><li class="dropdown-subitem"><a href="/python/%E8%AF%AD%E8%A8%80/%E6%B7%B1%E5%85%A5/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.html" class="nav-link" aria-label="深入"><!---->深入<!----></a></li><li class="dropdown-subitem"><a href="/python/%E8%AF%AD%E8%A8%80/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/Socket.html" class="nav-link" aria-label="网络编程"><!---->网络编程<!----></a></li><li class="dropdown-subitem"><a href="/python/%E8%AF%AD%E8%A8%80/%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%BC%96%E7%A8%8B/%E8%BF%9B%E7%A8%8B.html" class="nav-link" aria-label="多任务编程"><!---->多任务编程<!----></a></li><li class="dropdown-subitem"><a href="/python/%E8%AF%AD%E8%A8%80/asyncio/asyncio%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="asyncio"><!---->asyncio<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>生态</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/python/%E7%94%9F%E6%80%81/%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/gRPC.html" class="nav-link" aria-label="远程调用"><span class="icon iconfont icon-rpc"></span>远程调用<!----></a></li><li class="dropdown-subitem"><a href="/python/%E7%94%9F%E6%80%81/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kafka.html" class="nav-link" aria-label="消息队列"><span class="icon iconfont icon-kafka"></span>消息队列<!----></a></li><li class="dropdown-subitem"><a href="/python/%E7%94%9F%E6%80%81/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/Celery.html" class="nav-link" aria-label="异步任务"><span class="icon iconfont icon-tasks"></span>异步任务<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><span class="icon iconfont icon-database"></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/database/etcd/etcd.html" class="nav-link" aria-label="etcd"><span class="icon iconfont icon-etcd"></span>etcd<!----></a></li><li class="dropdown-item"><a href="/database/MySQL/MySQL.html" class="nav-link" aria-label="MySQL"><span class="icon iconfont icon-mysql"></span>MySQL<!----></a></li><li class="dropdown-item"><a href="/database/Redis/redis.html" class="nav-link" aria-label="Redis"><span class="icon iconfont icon-redis"></span>Redis<!----></a></li><li class="dropdown-item"><a href="/database/PostgreSQL/PostgreSQL.html" class="nav-link" aria-label="PostgreSQL"><span class="icon iconfont icon-postgresql"></span>PostgreSQL<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="操作系统"><span class="title"><span class="icon iconfont icon-os"></span>操作系统</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/unix/Linux/Linux%E5%9F%BA%E7%A1%80%E6%8C%87%E5%BC%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%A6%82%E8%AE%BA.html" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-linux"></span>Linux<!----></a></li><li class="dropdown-item"><a href="/unix/CentOS/%E5%AE%89%E8%A3%85/CentOS%E7%9A%84%E5%AE%89%E8%A3%85.html" class="nav-link" aria-label="CentOS"><span class="icon iconfont icon-centos"></span>CentOS<!----></a></li><li class="dropdown-item"><a href="/unix/Ubuntu/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/Ubuntu%E7%B3%BB%E5%88%97%E6%93%8D%E4%BD%9C.html" class="nav-link" aria-label="Ubuntu"><span class="icon iconfont icon-ubuntu"></span>Ubuntu<!----></a></li><li class="dropdown-item"><a href="/unix/%E8%99%9A%E6%8B%9F%E6%9C%BA/PVE/PVE.html" class="nav-link" aria-label="虚拟机"><span class="icon iconfont icon-pve"></span>虚拟机<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="运维工具"><span class="title"><span class="icon iconfont icon-devops"></span>运维工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/tool/Git/Git.html" class="nav-link" aria-label="Git"><span class="icon iconfont icon-git"></span>Git<!----></a></li><li class="dropdown-item"><a href="/tool/Nginx/Nginx%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="Nginx"><span class="icon iconfont icon-nginx"></span>Nginx<!----></a></li><li class="dropdown-item"><a href="/tool/Docker/docker%E5%AE%B9%E5%99%A8.html" class="nav-link" aria-label="Docker"><span class="icon iconfont icon-docker"></span>Docker<!----></a></li><li class="dropdown-item"><a href="/tool/Kubernetes/k8s%E8%B5%84%E6%BA%90Pod.html" class="nav-link" aria-label="Kubernetes"><span class="icon iconfont icon-kubernetes"></span>Kubernetes<!----></a></li><li class="dropdown-item"><a href="/tool/Other/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html" class="nav-link" aria-label="工具"><span class="icon iconfont icon-other"></span>工具<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="漫漫全干卷的苦"><span class="title"><!---->漫漫全干卷的苦</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="https://draveness.me/golang/" rel="noopener noreferrer" target="_blank" aria-label="GO" class="nav-link"><span class="icon iconfont icon-go"></span>GO<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="https://notes.fe-mm.com/interview/base/types.html" rel="noopener noreferrer" target="_blank" aria-label="前端内卷不归路" class="nav-link"><span class="icon iconfont icon-javascript"></span>前端内卷不归路<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/Igarashi-G" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><p class="sidebar-heading clickable"><span class="icon iconfont icon-mysql"></span><a href="/database/MySQL/" class="title">MySQL</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/database/MySQL/MySQL.html" class="nav-link sidebar-link sidebar-page" aria-label="MySQL"><!---->MySQL<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Mysql调优</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年10月12日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/Igarashi-G" target="_blank" rel="noopener noreferrer">五十岚</a></span><span property="author" content="五十岚"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年10月12日</span><meta property="datePublished" content="2022-10-12T14:58:07.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年10月12日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 24 分钟</span><meta property="timeRequired" content="PT24M"></span></div><hr></div><!----><!----><div class="theme-hope-content"><h1 id="mysql-调优" tabindex="-1"><a class="header-anchor" href="#mysql-调优" aria-hidden="true">#</a> MYSQL 调优</h1><p><a href="https://www.cnblogs.com/clschao/articles/10463743.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/clschao/articles/10463743.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><pre><code>引擎：
    InnoDB：插入时按主键排序插入（最常用） -- 聚集
    MYISAM：按照插入时顺序插入 -- 堆表（数据堆在一起）


一、页存储：
    操作系统中一页的容量为4KB,每一条数据插入时都是插入到页中，
    innodb_page_size  = 16384 （16kb）

    页结构图：
                            File Header
                            Page Header
                            Infimun + Supremun Records
                            - User Records
                            - Free Space
                            - Page Directory
                            File Trailer


二、InnoDB行格式：一行记录可以以不同形式记录在InnoDB中，格式分别有
    1.Compact：(紧密)
        变长字段长度列表 + NULL标志位 + 记录头信息 + 列1~N数据   （格式 外加下文的三个隐藏列）


    2.Redundant:

    3.Dynamic:(动态)
    4.Compressed:(压缩)
        这两种行格式类似于COMPACT，只不过在处理行溢出数据时有点分歧，不会在记录的真实数据处 存储一部分数据，
        而是把所有的数据都存储到其他页面中去，只在（本该）记录的真实数据处 存储其他页面的地址。
        另外Compressed 行格式会采用压缩算法对页面进行压缩。


    可以在创建或修改表的语句中指定：
        CREATED TABLE 表名 （列的信息） ROW_FORMT=行格式名称
        ALTER TABLE 表名 ROW_FORMT=行格式名称


    行大小：
        定义某一行数据（单个字段）最多有多大，最大长度除开BLOBS这个类型以外的其他字段，最大不能超过65535个字节
        a varchar（65535） --会报错  变长字段无NOT NULL则会增加3个字节记录从而占用空间（变长字段列表 + NULL标志位）

    行溢出：
        因此存在行数据这一页都容不下的可能性，便会将一行的数据 分成几个页去存

        方式一： 页存一部分数据 + 下一页的地址

        方式二： 页面不存数据， 只存起始页的地址  + 末尾页地址 （和索引有关，将这一页存多条记录，即多个不同页的地址）


    记录的真实数据：
        除了自定义的列数据以外，还有三个隐藏列:

        列名              是否必须        占用空间            描述
        row_id              否             6字节         行ID，唯一表示ID
        transaction_id      是             7字节           事务ID
        roll_pointer        是             7字节           回滚指针

        实际上真正名称为：DB_ROW_ID、DB_TRX_ID、DB_ROLL_PTR
        若表没有手动定义主键，则会选取一个Unique键作为主键（即唯一索引），若Unique键都没有定义的话，则会默认为表添加一个名为
        row_id 的隐藏列作为主键，所以row_id 是在没有自定义主键以及Unique键的情况下才会存在的


三、索引：
    页目录：
        本质是树，即用一个页 利用二分法进行来记录各数据的地址，每一页会有主键，并把主键提出来作为索引部分

              页号100                       页号200
            1 -&gt;  1111a                   5 -&gt; 5555e
                  2222b       -&gt;               6666f
            3 -&gt;  3333c...                7 -&gt; 7777g ...

    目录页:
        额外提出一个页，用来存储页号，但每一页的页号可不是相邻的，反而会再用一个 key-value 去存储页号
                    1                          5            --  主键
                   100                        200           --  指针
                    |                          |
                 页号100                    页号200          --  指针指向的行数据

        key：每页中最小的值， 利用主键都是递增顺序排列
        value：对应的页号

    因此就是一个B+树结构(根节点的元素总会留一个在叶子节点上) 一个节点也可以存多个元素
                                 0003 0005
             |                       |                         |
           0002                    0004                       0005
        |         |           |            |              |            |
    0001   -&gt;    0002   -&gt;   0003    -&gt;   0004   -&gt;    0005    -&gt;    0006 0007

    叶子节点：存数据
    非叶子节点：存主键 + 指针

    所以插入索引的过程中是生成B+树的过程，这就是为什么有序的原因，是存在了B+树的叶子节点里

    注：
        1.主键ID不适合太长，若过于长的话一页放不下，再会将树的高度拉长，树的高度越高，查找速度就会下降

        2.mysql 创建过程略微不同，他是当执行创建表命令时，就会创建一个页，当一个页装不下后，不是在创建第二个页，
          而是将第一个页copy一份，创建第二个页，再将之前的第一页改为目录页

        3.B+树的优势，相比于AVL树（二叉） B+树的优势在于一个节点可以存多个元素，因此会比AVL树高度要低，因此查找
          时的执行效率要低。虽然数据冗余了，查找 = 等于的条件不明显，但查找&gt; &lt; 条件时则不同

          例如： 查 &gt; 0002 的数据，可以直接利用索引（0002后的链表指针）提取所有数据，而AVL树要先找出右子树
                的节点，之后还要回归父节点，层层遍历  （SQL范围查询）

          据说 B+树高度等于2 的时候，大约可存 20000多条数据， B+树高度等于3 的时候， 可以存 2千万多条数据

          假设推算：主键用bigint类型 占8字节 指针占6个字节 因此在一页中，可以存多少个非叶子节点
                   16kb/(8+6)=1170.28... 可以存1170对 键值对（代表下面有多少个叶子节点）

                   此时假设一行数据为1KB，一页存16条数据，那么高度为2的情况下 可存 1170 * 16 = 18724 条数据
                   因此用B+树找最多找两次就能在2千多万条数据中找到那个页


    辅助索引：
        出了主键索引之外，创建的普通索引。好处在于更方便查找，但走辅助索引会走两次，因为建立辅助索引意味着全表
        又重新构建了一颗B+树，子节点存的是主键，走辅助索引会先找到主键在去主键表中找数据。
        例：
            create index idx_t1_bcd on t1(b,c,d);
            创建名为idx_t1_bcd的索引，bcd三列必须唯一且会进行排序，并再次生成一个已bcd为 键的B+树

        查找方式：
        1.辅助索引+ 回表
        2.全表扫描

        但当一个比较极端的情况，走辅助索引吧全表的主键都找了一遍，此时还不如走全表索引来得快：
        create index idx_t1_b on t1(b);   -- 此时只建立一个b的索引（上文索引无）
        explain select * from t1 where b &gt; 0; 此时 若走辅助索引还不如走主键全表扫描来的快
        因为 b &gt; 0 这个条件吧主键索引都找了出来，又去全表索引再找一遍，这就很慢。

        最左前缀原则：
            当建立 bcd 三列的索引时，
            explain select * from t1 where b = 1 and c = 1 and d = 1; -- 命中索引
            explain select * from t1 where c = 1 and d = 1; -- 未命中

            若数据从 111 到 644  *11 是没有办法进行比较的，第一个值不知道因此未走索引
                                    111     644
                                    页号    页号
                            |                           |
                     111    235                     322     644

            explain select * from t1 where b like &#39;%101%&#39;;  -- 未命中索引
            同上 % 在开头也意味着 第一个值是模糊的,开头可以是多个,而 &#39;101%&#39; 则可以

        注：
            1.用上文的道理，若要查找已.com 为后缀结尾的 用 %com，则会全表扫描，
                可以将 www.baidu.com 、www.google.com 这样的网站逆序存储，然后利用 %moc 进行查找
                则可直接命中索引

                select * from t1 order by b,c,d;  -- 走全表
                select b from t1 order by b,c,d;  -- 命中索引
                这是因为 只找一个b字段，b字段本身有索引，因此就无须再走一次全表了


            2.NULL 值在MYSQL中小于任何值

            3.若其他索引有相同的数据（不是唯一索引），则系统会默认将主键索引也加入B+树的构成中，便于区分
</code></pre><p>MYSQL 事务：</p><pre><code>一、事务（ACID）
    场景：小明向小胖转账10块钱

    原子性：转账操作是一个不可分割的操作，要么转账失败，要么转账成功，不可能存在中间状态，也就是转了一半的这种情况
        我们把要么全做要么不做这种的规则成为原子性规则

    隔离性：
        另一个场景：小明向小白转账10元钱
                   小明向小胖转账10元钱
        隔离性表示上面的两个操作是不能相互影响的

    一致性：
        每一次转账完成后，都需要保证整个系统余额等于所有账户的收入减去所有账户的支出。
        若不遵循原子性，也就是如果小明向小胖转账10元，但是只转了一半，小明账户上少了10元，小胖账户上没有增加，
        这就是不满足一致性原则。
        同样不满足隔离性，也有可能破坏一致性。因此原子性和隔离性都是保证满足一致性的手段。

        实际上，我们可以对表建立约束来保证一致性。

    持久性：
        对于转账的交易记录，需要永久保存。

    事务的概念：
        把需要保证原子性、隔离性、一致性、和持久性的一个或多个数据库操作称之为一个事务。


二、自动提交：
    mysql&gt; SHOW VARIABLES LIKE &#39;autocommit&#39;;   -- 正常情况下，MYSQL默认事务是ON 自动提交的

    自动提交意味着： 当写一个update之类的语句时，
     - 它会先帮我开启一个事务，
     - 再去执行我写的SQL
     - 再去把这个事务提交上去

    1、开启事务
        mysql&gt; BEGIN;  -- 手动开启一个事务

        mysql&gt; START TRANSACTION;   -- 和BEGIN功效相同，都是开启一个事务

        1.当开启两个MYSQL客户端是，客户端1 执行语句
        update t1 set c = 2 where  a = 1 ;  -- 目的是把a = 1 这行数据的c字段的值改为 2

        2.此时在客户端2 上执行
        select * from t1 where a = 1; -- 发现客户端2 中查询到的数据并没有改变

        3.这时在 客户端1 执行 commit; 提交一下，客户端2 中才能真正查到改动后的数据。
          但客户端1 则自己改的自己可以查到。

        4.若此时客户端1 上执行rollback 则会进行回滚，之前改动的数据则会改回。
            注：rollback 是我们程序员手动去回滚事务时才去使用的，若事务在执行过程中遇到了某些错误而无法继续执行的
                话，事务自身会回滚。

三、隐式提交：
    当使用 begin 或 start transaction 开启一个事务，或者把系统变量autocommit 的值设置为OFF 时，事务就不会进行自动
    提交，但是我们输入了某些语句之后会悄悄的提交掉，就像我们输入了commit 语句一样，这是因为某些特殊的语句而导致事务
    提交的情况称为隐式提交。

    导致隐式提交的语句包括：
    - 定义或修改数据库对象的数据定义语言（Data definition language 缩写：DDL）数据库对象 —— 是指数据库、表、
      视图、存储过程、等等这些东西。当我们使用 create、alter、drop等语句去修改这些所谓的数据库对象时，就会隐式的
      提交前边语句所属于的事务。

    - 隐式使用或修改mysql 数据库中的表; 当我们使用 alter user 、create user、drop user、grant、 rename user、
      set password 等语句时也会隐式的提交前边语句所属于的事务。

    - 事务控制或关于锁定的语句：当我们在一个事务还没提交或者回滚时就又使用start transaction 或者begin 开启了
      另一个事务时，会隐式的提交上一个事务，或者当前的autocommit 系统变量为OFF，我们手动把它调为ON时，也会隐式
      的提交前边语句所属的事务，或者用LOCK TABLES、 UNLOCK TABLES 等关于锁定的语句也会隐式的提交前边的语句所属
      的事务。

    - 加载数据的语句：比如我们使用LOAD DATA 语句来批量往数据库中导入数据时，也会隐式的提交前边语句所属的事务。

    - 其他的一些语句：使用analyze table、 cache index、 check table、flush、 load index into cache、
      optimize table、 repair table、 reset 等语句也会隐式的提交前边语句所属的事务。
      （更新查询优化器的统计数据的命令）

四、保存点：
    mysql&gt; savepoint 保存点名称：

    - 首先，开启一个事务：
      begin

    - 然后执行更改命令：
      update t1 set c = 6 where a = 1;

    - 再执行保存点命令：
      savepoint t123

    - 再改
      update t1 set c = 7 where a = 1;

    - 执行回滚
      rollback to t123;  -- rollback [WORK] to [savepoint] 保存点名称；
      若rollback 后面不跟随保存点名称的话，会直接回滚到事务执行之前的状态。

    - 删除保存点:
      release savepoint 保存点名称;


五、隔离性详解 ！！
    一共有四种隔离级别：
    mysql&gt; set session transaction isolation level read uncommitted; -- 修改隔离级别为（读未提交）

    mysql&gt; select @@tx_isolation;

    1.读未提交（read uncommitted）
        一个事务可以读到其他事务还未提交的数据，会出现脏读。
        &gt; 一个事务读到了另一个事务修改过但未提交的数据，即为脏读。

        用的少，违背事务的特性，不严谨

    2.读已提交（read committed）
        一个事务只能读到另一个事务修改过并已提交的数据，并且其他事务每对改数据进行一次修改并提交后，该事务都能查询到
        最新值，会出现不可重复读、幻读。
        &gt; 如果一个事务先根据某些条件查询出一些记录，之后另一个事务又向表中插入了符合这些条件的记录（并提交），原先的
        事务再次按照该条件查询时，能把另一个事务插入的记录也读出来，这就是幻读。

    3.可重复读（repeatable read）
        一个事务第一次读过某条记录后，即使其他事务修改了该记录的值并且提交，该事务之后再读该条记录时，读到的仍是第一次
        读到的值，而不是每次都读到不同的数据，这就是可重复读，这种隔离级别解决了不可重复，但是还是会出现幻读。

        也就是客户端1 尽管commit 客户端2 也读不到客户端1 commit 后的值 （其实按理说不会出现幻读了，但也可能发生）
        （MYSQL默认的隔离级别 就是可重复读）

    4.串行化（serializable）
        以上三种隔离级别都允许对同一条记录同时进行读-读、 读-写、 写-读、的并发操作，如果我们不允许读-写、 写-读
        的并发操作，可以使用serializable 隔离级别，这种隔离级别因为对同一条记录都是串行的，所以不会出现脏读、幻读
        等现象

        这中隔离方式，用的也不多，它会在一个客户端 的事务尚未操作commit 时阻塞其他的事务进行查找

    注：
        1.这四种隔离级别是SQL定义的标准，不同数据库会有不同的实现，特别需要注意的是 [MYSQL 在 repeatable read 隔离
            级别下，是可以禁止幻读问题的发生]

        2.幻读：本质和不可重复度差不多，幻读只的是多读出了另一个事务生成的一行记录，而不可重复读，指的是读某个记录的
            原本字段发生变化

六、事务ID及回滚指针
    1.事务id：
        如上文提到，mysql除自定义数据外，还有三个隐藏列，行id、事务id、回滚指针
        每一次数据进行改动时，都要开启一个事务，因此这行的其中一个隐藏列会记录当时修改的事务id

    2.回滚指针：
        当修改了一次数据，不仅会修改事务id，还有回滚指针记录上个版本的数据（像链表，存在日志中）
        如：
                     数据      事务id       回滚指针
                1 5 1 1 a2 a3   300    trx_id_roll_pointer  ____
            ____________________________________________________|
            |   1 4 1 1 a2 a3   200    trx_id_roll_pointer  ____
            ____________________________________________________|
            |——&gt;1 3 1 1 a2 a3   82     trx_id_roll_pointer  ____
            ____________________________________________________|
            |——&gt;1 2 1 1 a2 a3   81     trx_id_roll_pointer....


    3.版本链：
        以上为某一行数据的版本链，对于innodb来说，聚簇索引记录中都包含两个必要的隐藏列，（row_id 并不是必要的，我们
        创建的表中有主键或者非NULL唯一键时都不会包含row_id列）
        trx_id:每次对某条记录进行改动时，都会把对应的事务id赋值给trx_id 隐藏列
        roll_pointer:每次对某条记录进行改动时，这个隐藏列会存一个指针，可以通过这个指针找到记录修改前的信息

        注：事务回滚的依据是 undolog （后面提）

    4.read view:
        场景：A事务（id 300） 读取某一列值为 1   B事务（id 200） 修改某一列值为 2
        对于A事务在 select 读的时候会生成一个read view (里面会有一个重要属性 m_ids)
            m_ids:[]   -- 里面保存了活跃的事务id （还未提交的） [82, 200, 300]

            - 当A事务未提交时：
                会用事务id列表去版本链比对，判断对应事务是否是活跃的，若是，则不去里面找，直到找到不活跃的（已经
                提交了的事务，因此会把之前提交过的事务 81 对应的数据给找出来）[82, 200, 300]

            - 当A事务已经提交：（读已提交下）
                和上述类似，但由于A已经提交，则会根据A事务id 300把对应数据读出[82, 300]

            - 当A事务已提交：（可重复读）
                m_ids = [82, 200, 300]  此时与上面不同，不会把200 去掉，会直接用第一次select 事，算出来的
                read view 会直接去复用read view 即A事务未提交前的read view 。所以最后还是把81 找出的来。

            区别：在于生成read view 的时机不同，读已提交，是每次select 都会生成新的read view，
                  可重复读则是，只在第一次生成read view 之后都沿用这个 read view


    5.MVCC总结：
        MVCC（multi-version concurrency control，多版本并发控制）指的是 读已提交、可重复读这两中隔离级别
        的事务在执行普通的select 访问版本链的过程，可以使不同事务的读-写、写-读操作并发执行，从而提升系统性能。
        （避免使用锁，等释放的低效率行为）



七、锁
    0.概念图：
                                                                                ———————————————————————  表锁
            乐观锁 ——————————————                                               |
                                 ———— 加锁机制                      锁粒度 —————————————————————————————— 行锁
            悲观锁 ——————————————             |                    |            |
                                                                                ———————————————————————— 页锁
                                              ———————— 锁  ————————

            共享锁 ————————————                                               ———Record Lock（单个记录上锁）
                               |           |                       |         |
            排他锁 ————————————  ———— 兼容性                         锁算法 ———————Gap Lock（间隙锁，解决幻读）
                               |                                             |
            意向锁 ————————————                                               ———Next-Key Lock：Gap Lock+Record Lock


    1.读锁和写锁
        读锁：共享锁，shared locks S锁。
        写锁：排他锁，exclusive locks X锁。（一个资源上加了写锁，其他若需要加锁则需要排队）
        select：不加锁（可以跳过锁去访问）

        读操作：对于普通的select 语句，InnoDB不会加任何锁

    2.select ...lock in share mode
        将查找到的数据加上一个S锁，允许其他事务继续获取这些记录的S锁，不能获取这些记录的X锁（会阻塞）

        场景：读出数据后，其他事务不能修改，但是自己也不一定能修改，因为其他事务也可以使用&quot; select ...lock
         in share mode&quot; 继续加读锁。

    3.select ...for update
        将查找到的数据加上一个X锁，不允许其他事务获取这些记录的S锁和X锁。

        使用场景：读出数据后，其他事务既不能写，也不能加读锁，那么就导致只有自己可以修改数据。


    4.写操作：
        DELETE：删除一条记录，会先对记录加X锁，再执行
        INSERT：插入一条记录，会先加&quot;隐式锁&quot;来保护这条新记录在本事务提交前不被其他事务访问到。
        UPDATE：
            - 如果被更新的列，修改前后没有导致存储空间的变化，那么会先给记录加X锁，再直接对记录进行修改。
            - 如果被更新的列，修改前后导致存储空间发生了变化，那么后先给记录加X锁，然后再将记录删掉，再
              insert一条新纪录。

        隐式锁：一个事务插入一条记录后，还未提交，这条记录会保存本次事务id，而其他事务如果想来对这个记录加锁
            时会发现事务id 不对应，这时会产生X锁，所以相当于在插入一条记录时，隐式的给这条记录加了一把隐式的X锁。

        注：
            &gt; 事务提交或结束后，锁才会自动进行释放。
            &gt; 锁必须是在事务里面才用的。 因为平时开启是个事务不会手写begin、commit ，而是直接写sql，
              如：select * from t1 where a = 1 for update ;
              但要下意识知道，写这些sql的时候，会默认的先开启一个事务，而再来执行这个sql，然后再提交这个sql。

    5.行锁（锁算法）
        LOCK_REC_NOT_GAP: 单个行记录上的锁
        LOCK_GAP: 间隙锁，锁定一个范围，但不包括记录本身，GAP锁的目的，是为了防止同一事务的两次当前读，出现幻读
                    的情况
        LOCK_ORDINARY: 锁定一个范围，并且锁定记录本身对于行的查询，都是采用该方法，主要目的是解决幻读的问题。


    6.read committed 级别下的锁：
        - 当用主键查询时
            select * from t1 where a = 1 for update;
            再开启事务2，进行与上同样对 a = 1 的查询，此时会发现会阻塞。可若进行 a = 2 的主键查询则不会阻塞。
            这说明，事务1 利用主键查询，只会锁住查出来的这一行数据

        - 当用唯一索引查询时：
            与上文其实是一致的，

        - 当查询使用普通索引时：
            select * from t1 where e = &quot;b&quot; for update; -- 此时查出多条e = &quot;b&quot;的数据
            再开启事务2，但执行 a = 1 的主键查询（a = 1 的那条数据 e也等于&quot;b&quot;）发现事务2也会阻塞，但若找一个
            a = 6 这种（e 不等于 &quot;b&quot;）的数据，发现没有阻塞。
            这说明，普通索引，会对他查询出来的结果加锁。

            此时执行 insert t1(b, c, d, e) values(30, 1, 1, &quot;b&quot;); 插入数据，是可以进行插入e = &quot;b&quot;相关数据的。

        - 当全表扫描时：（未使用索引）
            其实同上，并不会锁住全表，也只会将事务1查询出来的数据锁住。


    7.repeatable read 级别下的锁：（mysql 默认的隔离级别 -- 可重复读）
        - 当使用主键、唯一索引查询时：
            和RC隔离级别一样，当执行主键 a &gt; 1 for update 条件时，会锁住全表，同样事务2 无法插入任何记录。

        - 当使用普通索引查询时:
            条件与上文一致，还是e = &quot;b&quot; 之后用事务2 查询事务1 之外的数据，发现还是可以查询到，但若此时执行插入
            insert t1(b, c, d, e) values(30, 1, 1, &quot;b&quot;);    此时会发现这条记录是插不进去的。

            但好理解的是，这样的目的本质就是为了防止 &quot;幻读&quot; 的发生

        - 当使用全表扫描时：
            同上，会将全表锁住，哪怕查询条件时 c = 1 for update，也不能更改 c = 10 的记录，因为可能会出现
            你想把 c = 10 改为 c = 1 的情况，因此锁住，防止幻读现象。

            注：
                对于可重复读的隔离级别下， 通常会将全表、所有的行、甚至包括间隙都全部锁住。


    8.乐观锁和悲观锁：
                    悲观锁                                         乐观锁
    概念：查询时直接锁住记录使得其他事务不能查询          提交更新时检查版本或时间戳是否符合
    语法：select * for update                          使用version 或者 timestamp进行比较
    实现者：数据库本身                                  开发者
    适用场景：并发量大                                  并发量小

    悲观锁：
        悲观的认为数据处理中，肯定会有其他事务进行修改数据，因此就将数据加锁，通常依靠关系型数据库的锁机制。
        不论是行锁、表锁、读写锁、都是悲观锁

    乐观锁：
        认为每次自己操作数据，都不会有其他事务来修改它，因此不加锁，但在更新的时候会判断此期间的数据有没有进行修改。需要
        自己实现，不会发生并发抢占资源，只有在提交的时候检查，是否违反数据完整性。
        原理出差CAS算法（不懂）但大概就像git一样。

    场景：
        读操作  远&gt;  写操作 时，此时一个更新操作加锁就会阻塞所有的读操作，降低吞吐量，最后还要释放锁，锁还要开销，因此用乐观锁

        读操作  ==  写操作 都差不多时，或者系统没有响应不及时（阻塞住的情况、吞吐量瓶颈等问题）那就不要使用乐观锁，它增加了
        复杂度，还带来了额外的业务风险，此时用悲观锁即可。

    python中使用悲乐锁：
        1.悲观锁的使用：
            必须关闭mysql的自动提交属性，即执行更改操作时会立即将结果提交。set autocommit = 0
            由select * from 表名 where id = 1 for update  加X锁这类型的语句衍生
            ORM中：
                # 开启事务装饰器 在指定函数前加上
                @transaction.atomic
                obj = 模型类名.objects.select_for_update.get(id = 1) # 即可实现悲观锁，若加锁失败则说明记录正在被修改，
                                                                    # 需要等待或是抛出异常

        2.乐观锁的使用：
            乐观锁其实并不是锁。通过SQL的where子句中的条件是否满足来判断是否满足更新条件来更新数据库，通过受影响行数判断
            是否更新成功，如果更新失败可以再次进行尝试，如果多次尝试失败就返回更新失败的结果。

            使用乐观锁时，必须设置数据库的隔离级别是Read Committed(可以读到其他线程已提交的数据)。如果隔离级别是
            Repeatable Read(可重复读，读到的数据都是开启事务时刻的数据，即使其他线程提交更新数据，该线程读取的数据
            也是之前读到的数据)，乐观锁如果第一次尝试失败,那么不管尝试多少次都会失败。 (Mysql数据库的默认隔离级别是
            Repeatable Read，需要修改成Read Committed)。

            # 首先引入
            from django.db import transaction

            # 以下为乐观锁视图层示例
            class MyView(View):

                @transaction.atomic
                def post(self, request):
                    &#39;&#39;&#39;订单创建&#39;&#39;&#39;
                    count = 3   # 订购3件商品

                    # 设置事务保存点
                    s1 = transaction.savepoint()

                    # 乐观锁，最多尝试5次
                    for i in range(5):
                        # 查询商品的信息(库存)
                        try:
                            sku = GoodsSKU.objects.get(id=1)
                        except:
                            # 商品不存在
                            transaction.savepoint_rollback(s1)
                            return JsonResponse({&#39;res&#39;: 1, &#39;errmsg&#39;: &#39;商品不存在&#39;})

                        # 判断商品的库存
                        if count &gt; sku.stock:
                            transaction.savepoint_rollback(s1)
                            return JsonResponse({&#39;res&#39;: 2, &#39;errmsg&#39;: &#39;商品库存不足&#39;})

                        # 更新商品的库存和销量
                        orgin_stock = sku.stock   # 原库存 (数据库隔离级别必须是Read Committed；如果是Repeatable Read,
                                                  #  那么多次尝试读取的原库存都是一样的,读不到其他线程提交更新后的数据。)
                        new_stock = orgin_stock - count   # 更新后的库存
                        new_sales = sku.sales + count   # 更新后的销量

                        # update 商品表 set stock=new_stock, sales=new_sales where id=1 and stock = orgin_stock
                        # 通过where子句中的条件判断库存是否进行了修改。(并发，乐观锁)
                        # 返回受影响的行数
                        res = GoodsSKU.objects.filter(id=1, stock=orgin_stock).update(stock=new_stock, sales=new_sales)
                        if res == 0:  # 如果修改失败
                            if i == 4:
                                # 如果尝试5次都失败
                                transaction.savepoint_rollback(s1)
                                return JsonResponse({&#39;res&#39;: 3, &#39;errmsg&#39;: &#39;下单失败&#39;})
                            continue  # 再次尝试

                        # 否则更新成功
                        # 跳出尝试循环
                        break


                    # 提交事务
                    transaction.savepoint_commit(s1)

                    # 返回应答
                    return JsonResponse({&#39;res&#39;: 4, &#39;message&#39;: &#39;创建成功&#39;})


        注：
            在并发比较少时建议使用乐观锁,减少加锁、释放锁的开销。在并发比较高的时候，建议使用悲观锁。

            如果乐观锁多次尝试的代价比较大，也建议使用悲观锁。

            乐观锁的处理方式可以理解为在进行数据操作时不加锁，在进行数据更新时进行判断，判断更新时的数据和之前的数据是否一致，
            如果不一致说明已被其他进程先进行操作


    9.优化SQL的方法：
        1.选取最适用的字段属性，尽可能减少定义字段宽度，尽量把字段设置NOTNULL，例如’省份’、&#39;性别’最好适用ENUM
        2.使用连接(JOIN)来代替子查询（使用多次查询来代替 JOIN）
        3.适用联合(UNION)来代替手动创建的临时表
        4.事务处理
        5.锁定表、优化事务处理
        6.适用外键，优化锁定表
        7.建立索引
</code></pre></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/10/12 14:58:07</span></div><!----></footer><!----><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2022 五十岚</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.4e18fb57.js" defer></script>
  </body>
</html>
