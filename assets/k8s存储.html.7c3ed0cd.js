import{_ as t}from"./plugin-vueexport-helper.2444895f.js";import{o as p,c as o,e as l,a as n,d as c,w as i,b as s,f as a,r as u}from"./app.e661506f.js";const r={},d=n("p",null,[n("strong",null,"k8s"),s(" \u5B58\u50A8\u76F8\u5173\u7684 "),n("strong",null,"Volumes"),s("\u3001"),n("strong",null,"PV"),s("\u3001"),n("strong",null,"PVC")],-1),k=a('<h1 id="kubernetes-\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#kubernetes-\u5B58\u50A8" aria-hidden="true">#</a> Kubernetes \u5B58\u50A8</h1><p>\u4E4B\u524D <strong>Pod</strong> \u793A\u4F8B\u4F7F\u7528\u8FC7\u90E8\u5206 <strong>Volumes</strong>\uFF0C\u6B64\u5904\u8BE6\u7EC6\u6574\u7406</p><h2 id="_1-volumes" tabindex="-1"><a class="header-anchor" href="#_1-volumes" aria-hidden="true">#</a> 1. Volumes</h2><p>\u5BB9\u5668\u7684\u78C1\u76D8\u6587\u4EF6\u662F <strong>\u77ED\u6682</strong>\uFF08<em>\u65E0\u72B6\u6001</em>\uFF09\u7684\uFF0C\u5BB9\u5668\u5D29\u6E83\u65F6\uFF0C\u6BCF\u6B21 <strong>kubelet</strong> \u90FD\u4F1A\u5168\u65B0\u91CD\u542F\u5E72\u51C0\u7684\u5BB9\u5668\uFF0C\u8FC7\u53BB\u7684\u4E34\u65F6\u6587\u4EF6\u4F1A\u5168\u90E8\u4E22\u5931\uFF0C\u800C\u4E14\u4E00\u4E2A <strong>Pod</strong> \u82E5\u8FD0\u884C\u4E86\u591A\u4E2A <strong>Container</strong> \u6587\u4EF6\u7684\u5171\u4EAB\u5982\u4F55\u89E3\u51B3\uFF0C\u6B64\u65F6\u5C31\u9700\u8981 <strong>k8s volumes</strong></p><h3 id="_1-1-\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#_1-1-\u6982\u8FF0" aria-hidden="true">#</a> 1.1 \u6982\u8FF0</h3><p>\u200B <strong>Docker</strong> \u4E5F\u6709\u5377\u7684\u6982\u5FF5\uFF0C\u4F46 <strong>Docker</strong> \u7684\u5377\u901A\u5E38\u662F\u78C1\u76D8\u6216\u53E6\u4E00\u4E2A <strong>Container</strong> \u4E2D\u7684\u76EE\u5F55\uFF0C\u4E14\u751F\u547D\u5468\u671F\u4E0D\u53D7\u7BA1\u7406\uFF0C\u5373\u4F7F\u540E\u7EED\u6709\u5377\u7684\u9A71\u52A8\u7A0B\u5E8F\uFF0C\u529F\u80FD\u4E5F\u5341\u5206\u6709\u9650</p><p>\u200B \u53E6\u4E00\u65B9\u9762\uFF0C<strong>k8s</strong> \u7684\u5377\u6709\u660E\u786E\u7684\u751F\u547D\u5468\u671F\uFF0C\u53EF\u4EE5\u6BD4 <strong>Pod</strong> \u4E2D\u8FD0\u884C\u7684\u4EFB\u4F55 <strong>Container</strong> \u90FD\u957F\uFF08<em><strong>Container</strong>\u91CD\u542F\u6216\u9500\u6BC1\u540E\u4FDD\u7559\u6570\u636E</em> \uFF09\u4E14\u652F\u6301\u591A\u79CD\u7C7B\u578B\u3001\u4EFB\u610F\u6570\u91CF\u7684 <strong>volumes</strong></p><p>\u200B \u672C\u8D28\u4E0A\u8BB2\uFF0C\u5377\u53EA\u662F\u4E00\u4E2A\u76EE\u5F55\uFF0C\u53EF\u80FD\u5305\u542B\u4E00\u4E9B\u6570\u636E\uFF0C <strong>Pod</strong> \u4E2D\u7684\u5BB9\u5668\u53EF\u4EE5\u8BBF\u95EE\u5B83\u3002\u8981\u4F7F\u7528\u5377\uFF0C<strong>Pod</strong> \u9700\u8981\u901A\u8FC7 <code>.spec.columes</code> \u5B57\u6BB5\u6307\u5B9A\u4E3A <strong>Pod</strong> \u63D0\u4F9B\u7684\u5377\uFF0C\u4EE5\u53CA\u4F7F\u7528 <code>.spce.containers.volumeMounts</code> \u5B57\u6BB5\u6307\u5B9A\u5377\u6302\u8F7D\u7684\u76EE\u5F55\u3002\u4ECE\u5BB9\u5668\u4E2D\u7684\u8FDB\u7A0B\u53EF\u4EE5\u770B\u5230\u7531 <strong>Docker</strong> \u955C\u50CF\u548C\u5377\u7EC4\u6210\u7684\u6587\u4EF6\u7CFB\u7EDF\u89C6\u56FE\uFF0C\u5377\u65E0\u6CD5\u6302\u8F7D\u5176\u4ED6\u5377\u6216\u5177\u6709\u5230\u5176\u4ED6\u5377\u7684\u786C\u94FE\u63A5\uFF0C <strong>Pod</strong> \u4E2D\u7684\u6BCF\u4E2A <strong>Container</strong> \u5FC5\u987B\u72EC\u7ACB\u6307\u5B9A\u6BCF\u4E2A\u5377\u7684\u6302\u8F7D\u4F4D\u7F6E</p><h4 id="\u5E38\u7528\u5377\u7684\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#\u5E38\u7528\u5377\u7684\u7C7B\u578B" aria-hidden="true">#</a> \u5E38\u7528\u5377\u7684\u7C7B\u578B</h4>',9),m=a(`<h3 id="_2-1-emptydir" tabindex="-1"><a class="header-anchor" href="#_2-1-emptydir" aria-hidden="true">#</a> 2.1 emptyDir</h3><p>\u200B <strong>\u4E3B\u8981\u7528\u4E8E\u4E0D\u540C\u5BB9\u5668\u95F4 \u6570\u636E\u5171\u4EAB \u7684</strong>\uFF0C\u4F46\u548C <strong>Volume</strong> \u4E0D\u540C\u5728\u4E8E\uFF0C\u5220\u9664 <strong>Pod</strong> \u540E <strong>emptyDir</strong> \u5377\u4E2D\u7684\u6570\u636E\u4E5F\u4F1A\u5220\u9664\uFF0C<strong>\u53EF\u88AB\u6302\u8F7D\u5230\u76F8\u540C\u6216\u4E0D\u540C\u7684\u8DEF\u5F84</strong>\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u652F\u6301\u4EFB\u4F55\u4ECB\u8D28\uFF08<em>\u78C1\u76D8\u3001<strong>SSD</strong>\u3001\u7F51\u7EDC\u5B58\u50A8</em> \uFF09</p><p>\u200B \u53EF\u4EE5\u5C06 <code>emptyDir.medium</code> \u5B57\u6BB5\u8BBE\u7F6E\u4E3A <code>Memory</code> \uFF0C\u8BA9 <strong>Kubernetes</strong> \u4F7F\u7528 <strong>tmpfs</strong>\uFF08<em>\u5185\u5B58\u652F\u6301\u7684\u6587\u4EF6\u7CFB\u7EDF</em>\uFF09\u867D\u7136 <strong>tmpfs</strong> \u5F88\u5FEB\uFF0C\u4F46\u8282\u70B9\u91CD\u542F\u65F6\u6570\u636E\u540C\u6837\u4F1A\u88AB\u6E05\u9664\uFF0C\u5E76\u4E14\u8BBE\u7F6E\u7684\u5927\u5C0F\u4F1A\u88AB\u8BA1\u5165\u5230 <strong>Container</strong> \u7684\u5185\u5B58\u9650\u5236\u4E2D</p><p>\u4F7F\u7528\u65F6 <code>volumes</code> \u76F4\u63A5\u6307\u5B9A\u4E3A <strong>emptyDir</strong> \u5373\u53EF</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>pd
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/test<span class="token punctuation">-</span>webserver
    <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>container
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /cache
      <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container danger"><p class="custom-container-title">\u8B66\u544A</p><p>\u82E5\u8981\u5728\u4E00\u4E2A <strong>Pod</strong> \u91CC\u9762\u542F\u52A8\u591A\u4E2A\u5BB9\u5668\u7684\u8BDD\uFF0C\u7F51\u7EDC\u547D\u540D\u7A7A\u95F4\u662F\u5171\u4EAB\u7684\uFF0C\u5047\u5982\u6B64\u65F6\u8D77\u4E86\u4E24\u4E2A <strong>Nginx</strong> \u8FDB\u7A0B\u5982\u4E0B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.15.2
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /opt
          <span class="token key atrule">name</span><span class="token punctuation">:</span> share<span class="token punctuation">-</span>volume
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx2
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.15.2
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /mnt
          <span class="token key atrule">name</span><span class="token punctuation">:</span> share<span class="token punctuation">-</span>volume
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> share<span class="token punctuation">-</span>volume
        <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u90FD\u662F <strong>80</strong> \u7AEF\u53E3\uFF0C\u5219\u4F1A\u51B2\u7A81</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> dev get po
NAME                                READY   STATUS        RESTARTS   AGE
nginx-deployment-5bd68dfc65-6jzzw   <span class="token number">1</span>/2     Error         <span class="token number">0</span>          11s
nginx-deployment-5bd68dfc65-7snw5   <span class="token number">1</span>/2     Error         <span class="token number">0</span>          11s
nginx-deployment-5bd68dfc65-z5zqc   <span class="token number">1</span>/2     Error         <span class="token number">0</span>          11s

$ kubectl <span class="token parameter variable">-n</span> dev logs <span class="token parameter variable">-f</span> nginx-deployment-5bd68dfc65-6jzzw <span class="token parameter variable">-c</span> nginx2
<span class="token punctuation">..</span>.
<span class="token number">2022</span>/10/30 <span class="token number">10</span>:11:38 <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: bind() to 0.0.0.0:80 failed (98: Address already in use)</span>
nginx: <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> bind<span class="token punctuation">(</span><span class="token punctuation">)</span> to <span class="token number">0.0</span>.0.0:80 failed <span class="token punctuation">(</span><span class="token number">98</span>: Address already <span class="token keyword">in</span> use<span class="token punctuation">)</span>
<span class="token number">2022</span>/10/30 <span class="token number">10</span>:11:38 <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: still could not bind()</span>
nginx: <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> still could not bind<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u8981\u5C06 <code>name: nginx2</code> \u7684 <code>command</code> \u91CD\u7F6E</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> sh
<span class="token punctuation">-</span> <span class="token punctuation">-</span>c
<span class="token punctuation">-</span> sleep 36000
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5982\u4E0A\u914D\u7F6E\u662F\u901A\u8FC7 <code>sh</code> \u6267\u884C\u4E86\u4E00\u4E2A <code>sleep</code> \u547D\u4EE4</p><p>\u82E5\u51FA\u73B0 <strong>Error: Back-off restarting failed</strong> \uFF0C\u901A\u7528\u89E3\u51B3\u529E\u6CD5\u4E5F\u53EF\u5728 <code>containers:</code> \u540E\u52A0\u5165\u547D\u4EE4\u5E38\u9A7B\u8FDB\u7A0B</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-ce&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tail -f /dev/null&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E4B\u540E\u5373\u53EF\u6D4B\u8BD5\u4E00\u4E0B\u662F\u5426\u6570\u636E\u5DF2\u5171\u4EAB</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> dev <span class="token builtin class-name">exec</span> <span class="token parameter variable">-ti</span> nginx-deployment-5666cb4fcf-2d8m6 <span class="token parameter variable">-c</span> nginx -- <span class="token function">bash</span>
$ <span class="token builtin class-name">cd</span> /opt/
$ <span class="token function">touch</span> <span class="token number">123</span>.txt
$ <span class="token function">ls</span>
<span class="token number">123</span>.txt
root@nginx-deployment-5666cb4fcf-2d8m6:/opt<span class="token comment"># exit</span>

$ kubectl <span class="token parameter variable">-n</span> dev <span class="token builtin class-name">exec</span> <span class="token parameter variable">-ti</span> nginx-deployment-5666cb4fcf-2d8m6 <span class="token parameter variable">-c</span> nginx2 -- <span class="token function">bash</span>
$ <span class="token builtin class-name">cd</span> /mnt
$ <span class="token function">ls</span>
<span class="token number">123</span>.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u8868\u793A\uFF0C\u6570\u636E\u5DF2\u7ECF\u901A\u8FC7\u6307\u5B9A <strong>emptyDir</strong> \u5B9E\u73B0\u5171\u4EAB</p></div><h3 id="_2-2-hostpath" tabindex="-1"><a class="header-anchor" href="#_2-2-hostpath" aria-hidden="true">#</a> 2.2 hostPath</h3>`,7);function v(b,g){const e=u("RouterLink");return p(),o("div",null,[d,l(" more "),k,n("p",null,[c(e,{to:"/tool/Kubernetes/k8s%E5%AD%98%E5%82%A8.html#_2-1-emptydir"},{default:i(()=>[s("emptyDir")]),_:1}),s(": \u5BB9\u5668\u95F4\u6570\u636E\u5171\u4EAB\uFF0C\u6613\u5931")]),m])}const x=t(r,[["render",v],["__file","k8s\u5B58\u50A8.html.vue"]]);export{x as default};
