import{_ as i}from"./plugin-vueexport-helper-DlAUqK2U.js";import{c as a,d as n,o as e}from"./app-BFWhIhUk.js";const l={};function t(h,s){return e(),a("div",null,s[0]||(s[0]=[n(`<p><strong>k8s</strong> 下 <strong>prometheus</strong> 的安装部署</p><h2 id="安装-kube-prometheus" tabindex="-1"><a class="header-anchor" href="#安装-kube-prometheus"><span>安装 kube-prometheus</span></a></h2><p><a href="https://github.com/prometheus-operator/kube-prometheus" target="_blank" rel="noopener noreferrer">Github 地址</a> 此处克隆的是 <strong>release-0.4</strong> 版本的，<strong>yaml</strong> 文件如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> release-0.4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --single-branch</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/prometheus-operator/kube-prometheus.git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 该目录下定义好了部署的 yaml </span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./kube-prometheus/manifests</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 其中</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># alertmanager-alertmanager.yaml 	定义了 alertmanager</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># prometheus-prometheus.yaml 		定义了 prometheus server端</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># prometheus-rules.yaml 			定义了 prometheus 的基本规则</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># node-exporter* 					采集宿主机的监控数据的（比zabbix更详细）</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># grafana-deployment.yaml 			继承了很多 dashboard，通过 ConfigMap 注入</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># grafana-dashboardDefinitions.yaml 定义了很多 dashboard，都放到了 ConfigMap 里面</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>使用容器不方便，经常会改里面的模板、创建模板等没有存储会很复杂</p><ul><li>若容器部署，新增一个模板就需要修改上述定义 <strong>dashboard</strong> 并挂载到 <strong>configMap</strong> 中，<strong>grafana</strong> 才能读取到</li><li>有多个 <strong>configMap</strong> ，因为 <strong>etcd</strong> 默认限制大小为 <strong>1.5 Mib（Raft<em>消息限制</em> ）</strong> 过大的配置文件会影响其性能（<em>虽然可修改</em> ）</li><li>加一个模板就需要创建一个 <strong>configMap</strong> 然后在 <code>grafana-deployment.yaml</code> 中的 <strong>volumes:</strong> 下，挂载一大堆，新增也需要沿用这种方式挂载</li></ul><p>因此建议 <strong>grafana</strong> 最好挂个存储（<em>数据目录</em>），若没有存储的话最好使用宿主机部署</p><ul><li>这样可以直接上传一个 <strong>dashboard</strong> 定义到宿主机或存储中</li><li><strong>grafana</strong> 是个界面展示，挂了无妨，但要在 <strong>grafana</strong> 上做告警，也不能挂</li><li>有 <strong>alertmanager</strong> 的告警，就不需要用 <strong>grafana</strong> 的告警了，更为灵活</li></ul></div><p>部署 <strong>prometheus</strong>、<strong>grafana</strong> 和 <strong>alertmanager</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进入 setup 目录下安装 operator</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./kube-prometheus/manifests/setup</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装该目录下所有 yaml 文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> created</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">clusterrolebinding.rbac.authorization.k8s.io/prometheus-operator</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> created</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">deployment.apps/prometheus-operator</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> created</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service/prometheus-operator</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> created</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">serviceaccount/prometheus-operator</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> created</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看运行，此时已经创建好了 operator</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> po</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                   READY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   STATUS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    RESTARTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prometheus-operator-5f75d76f9f-zkzf6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   1/1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          1m20s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 返回上级，然后创建 prometheus 的集群</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ls</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 最好将 alertmanager 中的 副本改为 3 个,因为生成环境中 3 个会通过 POSIX 协议通信，而不会发3次告警</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># vim alertmanager-alertmanager.yaml</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># replicas: 3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看运行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> po</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -owide</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NNAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                   READY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   STATUS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              RESTARTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">alertmanager-main-0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    0/2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ContainerCreating</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          108s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grafana-58dc7468d7-wmp2p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               0/1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          106s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kube-state-metrics-765c7c7f95-xn6kh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    0/3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ContainerCreating</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          104s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">node-exporter-99kq7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    0/2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ContainerCreating</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          104s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">node-exporter-b9pfp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    2/2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          104s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">node-exporter-qrdmv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    0/2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ContainerCreating</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          104s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prometheus-adapter-5cd5798d96-72fsl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    1/1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          102s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prometheus-k8s-0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                       0/3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ContainerCreating</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          98s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prometheus-k8s-1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                       0/3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     ContainerCreating</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          98s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prometheus-operator-5f75d76f9f-zkzf6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   1/1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          18m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看 <strong>service</strong> 如下服务</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> svc</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                    TYPE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        CLUSTER-IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       EXTERNAL-IP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   PORT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">S</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">alertmanager-main</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       ClusterIP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   10.96.65.3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">9093/TCP</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grafana</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                 ClusterIP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   10.109.31.26</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">3000/TCP</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prometheus-k8s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          ClusterIP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   10.105.151.175</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">non</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">e&gt;        </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">9090/TCP</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">..</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>alertmanager-main</strong> 用于查看当前告警有哪些、通知告警</li><li><strong>grafana</strong> 监控面板、展示数据</li><li><strong>prometheus-k8s</strong> 创建规则、校验、查询操作、<strong>target</strong> 等</li></ul><p>使用 <strong>ingress</strong> 配置如上服务对应的域名（<em>若没配置 <strong>ingress</strong> 先去配 <strong>ingress</strong> 的控制器</em> ）</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置 ingress 如下</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">apiVersion: extensions/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">kind: Ingress</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  name: prom-ingresses</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  namespace: monitoring</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">spec:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  rules:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  - host: alert.test.com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    http:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      paths:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      - backend:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">          serviceName: alertmanager-main</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">          servicePort: 9093</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        path: /</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  - host: grafana.test.com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    http:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      paths:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      - backend:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">          serviceName: grafana</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">          servicePort: 3000</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        path: /</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  - host: prom.test.com</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">    http:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      paths:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">      - backend:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">          serviceName: prometheus-k8s</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">          servicePort: 9090</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">        path: /</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">status:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  loadBalancer: {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看创建的 <strong>ingress</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ingress</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             HOSTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                           ADDRESS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   PORTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">prom-ingresses</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   alert.test.com,grafana.test.com,prom.test.com</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">             80</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      78s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <strong>hosts</strong> 后即可访问域名，其中 <strong>grafana</strong> 的初始账户密码都为 <code>admin</code> ，登入后需修改（<em>若没有持久化，每次重启都会还原，此处修改为 <code>user@dev</code>备忘</em> ）</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">192.168.3.172	alert.test.com prom.test.com grafana.test.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,16)]))}const r=i(l,[["render",t]]),d=JSON.parse('{"path":"/tool/Prometheus/%E5%AE%89%E8%A3%85.html","title":"安装 kube-prometheus","lang":"zh-CN","frontmatter":{"title":"安装 kube-prometheus","date":"2022-10-24T00:00:00.000Z","category":["运维","k8s","prometheus"],"tag":["prometheus","监控"],"star":true,"description":"k8s 下 prometheus 的安装部署","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"安装 kube-prometheus\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-10-24T00:00:00.000Z\\",\\"dateModified\\":\\"2023-01-09T06:55:55.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"悦·宝宝\\",\\"url\\":\\"https://github.com/Igarashi-G\\"}]}"],["meta",{"property":"og:url","content":"https://igarashi-g.github.io/tool/Prometheus/%E5%AE%89%E8%A3%85.html"}],["meta",{"property":"og:site_name","content":"悦 ▪ 宝宝"}],["meta",{"property":"og:title","content":"安装 kube-prometheus"}],["meta",{"property":"og:description","content":"k8s 下 prometheus 的安装部署"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-01-09T06:55:55.000Z"}],["meta",{"property":"article:tag","content":"监控"}],["meta",{"property":"article:tag","content":"prometheus"}],["meta",{"property":"article:published_time","content":"2022-10-24T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-01-09T06:55:55.000Z"}]]},"git":{"createdTime":1669513703000,"updatedTime":1673247355000,"contributors":[{"name":"Igarashi","username":"Igarashi","email":"2545369032@qq.com","commits":3,"url":"https://github.com/Igarashi"}]},"readingTime":{"minutes":2.89,"words":866},"filePathRelative":"tool/Prometheus/安装.md","excerpt":"<p><strong>k8s</strong> 下 <strong>prometheus</strong> 的安装部署</p>\\n","autoDesc":true}');export{r as comp,d as data};
