import{_ as p}from"./plugin-vueexport-helper-DlAUqK2U.js";import{c as d,d as h,e as k,w as l,r,o as g,a as s,b as i}from"./app-BSKYQGO5.js";const c="/assets/X500-CANmQlc0.png",A="/assets/DIT-CXuvuwzY.png",o="/assets/%E5%88%86%E5%B8%83%E5%BC%8F-B6LUo9pd.png",y="/assets/LDAP-DCw5DyT8.jpg",F="/assets/ssp-DSrTEeIx.png",u="/assets/ldap%E5%8A%A0%E5%9F%9F%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF-CsqL6Yjp.png",v={};function b(m,a){const t=r("Tabs");return g(),d("div",null,[a[10]||(a[10]=h('<h1 id="ldap" tabindex="-1"><a class="header-anchor" href="#ldap"><span>LDAP</span></a></h1><p><strong>DAP（Directry Access Protocol）：</strong> 即目录访问协议，较老、复杂且重量级，后面又出轻量级、更好用的 <strong>LDAP</strong></p><h2 id="_1-x-500-协议" tabindex="-1"><a class="header-anchor" href="#_1-x-500-协议"><span>1. X.500 协议</span></a></h2><h3 id="_1-1-概述" tabindex="-1"><a class="header-anchor" href="#_1-1-概述"><span>1.1 概述</span></a></h3><p><strong>X.500</strong> 定义了目录系统，<strong>LDAP</strong> 只是它的轻量级实现</p><h5 id="目录系统" tabindex="-1"><a class="header-anchor" href="#目录系统"><span><strong>目录系统</strong></span></a></h5><p><strong>Directory：</strong> 目录服务，旨在提供一个用户友好的 <code>name-address</code> 类的映射，其中 <code>name</code> 不可变，<code>address</code> 允许动态变化，即<code>key-value</code> 结构</p><p><strong>DIB：</strong> 目录信息库，由一批系统组成，每个系统持有对应现实世界的逻辑数据，这些存储的数据叫做 <strong>DIB</strong></p><img src="'+c+'"><p>一个标准的目录系统，有以下几部分</p><ul><li>目录服务</li><li>目录服务的用户</li><li>目录服务用来暴露自己的访问端点</li><li>用户和服务之间使用协议如 LDAP 进行交互</li><li>用户使用 LDAP 客户端访问目录服务</li></ul><h3 id="_1-2-dib-与-dit" tabindex="-1"><a class="header-anchor" href="#_1-2-dib-与-dit"><span>1.2 DIB 与 DIT</span></a></h3><p><strong>DIB</strong> 目录信息库，由 <strong>DIT</strong>（<em>目录信息树</em>）、节点 <strong>Entry</strong>、<strong>Entry</strong> 中的属性及属性值构成，树形结构</p><ul><li><strong>Entry</strong> 代表一个节点，类型可以是 <code>object</code>，也可以是 <code>alias</code> 别名</li><li>一个 <strong>Entry</strong> 内可以拥有多个属性</li><li>一个属性内可以拥有一个 <strong>Type</strong>，以及多个 <strong>Value</strong></li></ul><img src="'+A+'"><div class="hint-container tip"><p class="hint-container-title">提示</p><p>故这种树形存储结构适用于，查询多、更新少</p></div><h3 id="_1-3-分布式-directory" tabindex="-1"><a class="header-anchor" href="#_1-3-分布式-directory"><span>1.3 分布式 Directory</span></a></h3><p><strong>Directory</strong> 支持分布式操作，此时的服务端组成如下</p><img src="'+o+'"><p><strong>DSA（<em>Directory System Agent</em>）：</strong> 用来连接服务和 <strong>DUA</strong>。他可以缓存 <strong>Directory</strong> 数据，可以用本地数据直接响应，也可以单纯做一个转发</p><p><strong>LDAP Server</strong>：是 <strong>Directory Service</strong> 的一部分，可以直接使用本地数据，也可以转发到其它 <strong>LDAP Server</strong> 获取数据</p><h2 id="_2-ldap-协议" tabindex="-1"><a class="header-anchor" href="#_2-ldap-协议"><span>2. LDAP 协议</span></a></h2><p><strong>LDAP 协议：</strong> 是 <strong>轻量级的目录访问协议</strong>，其中</p><ul><li><p><strong>L（<em>LightWeight</em>）：</strong> 轻量级</p></li><li><p><strong>D（<em>Directory</em>）：</strong> 目录</p></li><li><p><strong>AP（<em>Access Protocol</em>）：</strong> 存取协议</p></li></ul><p>是 <strong>读性能高，写性能低且没有回滚机制</strong> 的数据存储协议，不是数据库，没有数据库这么强大，而是一个树状结构的目录，每个叶子都是由一条一条的分成若干区域的记录</p><img src="'+y+'"><h3 id="_2-1-概念说明" tabindex="-1"><a class="header-anchor" href="#_2-1-概念说明"><span>2.1 概念说明</span></a></h3><p><strong>Entry：</strong> 最小单元 (<em>对象</em>）</p><p><strong>LDIF：</strong> 上文 <strong>Entry</strong> 的纯文本表示文件</p><p><strong>Schema：</strong> 模式（<em>对象类的集合</em>）对属性做了限制</p><p><strong>attribute：</strong> 基本对象的属性</p><p><strong>ObjectClass：</strong> 属性集合（<em>基本对象的继承属性</em>）</p><p><strong>backend &amp; database</strong></p><p><a href="./AD">属性说明 - 参考 AD</a></p><p><a href="https://blog.csdn.net/zou8944/article/details/122287398" target="_blank" rel="noopener noreferrer">参考详解 LDAP</a></p><h2 id="_3-搭建-ldap服务端" tabindex="-1"><a class="header-anchor" href="#_3-搭建-ldap服务端"><span>3. 搭建 LDAP服务端</span></a></h2><p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system-level_authentication_guide/openldap" target="_blank" rel="noopener noreferrer">ReadHat OpenLDAP</a></p><p><a href="http://www.openldap.org/" target="_blank" rel="noopener noreferrer">OpenLDAP</a> 是一款 <strong>LDAP</strong> 开源集中账号管理的实现，支持众多系统版本，被广大互联网公司使用，<strong>openldap-server</strong> 的数据必须用原配的 <strong>Berkeley DB</strong>，不能使用 <strong>MySQL</strong> 作为后端数据库</p>',38)),k(t,{id:"161",data:[{id:"CentOS"}]},{title0:l(({value:n,isActive:e})=>a[0]||(a[0]=[i("CentOS")])),tab0:l(({value:n,isActive:e})=>a[1]||(a[1]=[s("p",null,[s("strong",null,"关闭 selinux 和防火墙")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"setenforce"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," 0")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sed"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -i"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," '/SELINUX/s/enforcing/disabled/'"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/selinux/config")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," disable"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," firewalld.service"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," && "),s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," stop"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," firewalld.service")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," stop"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," NetworkManager"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," && "),s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," disable"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," NetworkManager")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[s("strong",null,"按需换源")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sed"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!^#baseurl=!baseurl=!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"       -e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"  's!^mirrorlist=!#mirrorlist=!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"       -e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!mirror.centos.org!mirrors.ustc.edu.cn!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"       -i"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"  /etc/yum.repos.d/CentOS-Base.repo")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"yum"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -y"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," epel-release")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"sed"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!^mirrorlist=!#mirrorlist=!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"	-e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!^#baseurl=!baseurl=!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"	-e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!^metalink!#metalink!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"	-e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!//download\\.fedoraproject\\.org/pub!//mirrors.ustc.edu.cn!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"	-e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 's!http://mirrors\\.ustc!https://mirrors.ustc!g'"),s("span",{style:{"--shiki-light":"#0184BC","--shiki-dark":"#56B6C2"}}," \\")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"	-i"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/yum.repos.d/epel.repo"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /etc/yum.repos.d/epel-testing.repo")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[s("strong",null,"同步时间")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"yum"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -y"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ntpdate"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ntp")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"ntpdate"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 0.cn.pool.ntp.org")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"hwclock"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," --systohc")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"cat"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," <<"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"EOF>>"),s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}}," /etc/ntp.conf")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"driftfile /var/lib/ntp/drift")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"server 0.cn.pool.ntp.org")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"server 1.cn.pool.ntp.org")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"server 2.cn.pool.ntp.org")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"server 3.cn.pool.ntp.org")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"EOF")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"systemctl enable ntpd  && systemctl start ntpd")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"ntpq -p")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[s("strong",null,"安装 OpenLDAP")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"yum"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -y"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," install"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," openldap"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," compat-openldap"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," openldap-clients"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," openldap-servers"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," openldap-servers-sql"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," openldap-devel"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," migrationtools")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"})])],-1),s("p",null,[s("strong",null,"查看 OpenLDAP 版本")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"slapd"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -VV")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"@(#) $OpenLDAP: slapd 2.4.44 (Feb 23 2022 17:11:27) $")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"	mockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[s("strong",null,"OpenLDAP"),i(" 相关配置文件信息")],-1),s("ul",null,[s("li",null,[s("code",null,"/etc/openldap/slapd.conf："),i(),s("strong",null,"OpenLDAP"),i(" 主配置文件，记录根域信息，管理员名称，密码，日志，权限等")]),s("li",null,[s("code",null,"/etc/openldap/slapd.d/*："),i(" 这下面是 "),s("code",null,"/etc/openldap/slapd.conf"),i(" 配置信息生成的文件，每修改一次配置信息，这里的东西就要重新生成")]),s("li",null,[s("code",null,"/etc/openldap/schema/*："),i(),s("strong",null,"OpenLDAP"),i(" 的 "),s("strong",null,"schema"),i(" 存放的地方")]),s("li",null,[s("code",null,"/var/lib/ldap/*："),i(),s("strong",null,"OpenLDAP"),i(" 的数据文件")]),s("li",null,[s("code",null,"/usr/share/openldap-servers/DB_CONFIG.example："),i(" 模板数据库配置文件")])],-1),s("p",null,[s("strong",null,"OpenLDAP"),i(" 监听的端口")],-1),s("ul",null,[s("li",null,[i("默认监听端口："),s("strong",null,"389"),i("（"),s("em",null,"明文数据传输"),i("）")]),s("li",null,[i("加密监听端口："),s("strong",null,"636"),i("（"),s("em",null,"密文数据传输"),i("）")])],-1),s("p",null,[i("启动 "),s("strong",null,"slapd"),i(" 服务")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," start"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," slapd")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"systemctl"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," enable"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," slapd")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1)])),_:1}),a[11]||(a[11]=h(`<h3 id="_3-1-配置-openldap" tabindex="-1"><a class="header-anchor" href="#_3-1-配置-openldap"><span>3.1 配置 OpenLDAP</span></a></h3><h5 id="配置openldap数据库" tabindex="-1"><a class="header-anchor" href="#配置openldap数据库"><span><strong>配置OpenLDAP数据库</strong></span></a></h5><p><strong>OpenLDAP</strong> 默认使用 <strong>BerkeleyDB</strong>，如下命令配置数据库</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/openldap-servers/DB_CONFIG.example</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/ldap/DB_CONFIG</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>生成 ldap 管理员密码</strong> （<em>初始化后默认空密码</em> ）</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">slappasswd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user@dev</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{SSHA}rEXQDROfAHRMoZS1TnFTZBsNL+387ogk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改 olcDatabase={2}hdb.ldif 文件</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/slapd.d/cn</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">config/olcDatabase</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\=\\{</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">hdb.ldif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcSuffix:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcRootDN:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cn=cloud,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcRootPW:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {SSHA}rEXQDROfAHRMoZS1TnFTZBsNL+387ogk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改olcDatabase={1}monitor.ldif文件</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/slapd.d/cn</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">config/olcDatabase</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\=\\{</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">monitor.ldif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcAccess:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}to</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=extern</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> al,cn=auth&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dn.base=&quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> none</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 <code>dn.base</code> 是修改 <strong>OpenLDAP</strong> 的管理员信息的</p><p><strong>验证 OpenLDAP 的基本配置</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">slaptest</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5d30769d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldif_read_file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checksum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/etc/openldap/slapd.d/cn=config/olcDatabase={1}monitor.ldif&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5d30769d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldif_read_file:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checksum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/etc/openldap/slapd.d/cn=config/olcDatabase={2}hdb.ldif&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> testing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> succeeded</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>校验error请忽略</p></blockquote><p><strong>修改ldap文件权限</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chown</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldap:ldap</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/lib/ldap/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chown</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldap:ldap</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>启动并查看</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --now</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ss</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -natup</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 389</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    LISTEN</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      128</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">       *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:389</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                   *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                   users:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;slapd&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,pid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=1773,fd=8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tcp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    LISTEN</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      128</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      :::389</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  :::</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                   users:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;slapd&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,pid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=1773,fd=9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导入基本 Schema</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看预生成的 ldif 文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ll</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/schema</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/schema/cosine.ldif</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/schema/nis.ldif</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/schema/inetorgperson.ldif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 注意！！加域必须要如下ldif 文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/openldap/schema/samba.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改 migrate_common.ph 文件</strong></p><p>改文件主要用于生成 <strong>ldif</strong> 文件使用，修改如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/migrationtools/migrate_common.ph</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +71</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Default DNS domain</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$DEFAULT_MAIL_DOMAIN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uit.ldevops.local&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Default base </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$DEFAULT_BASE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$EXTENDED_SCHEMA</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>生成 base.ldif</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/share/migrationtools/migrate_base.pl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/base.ldif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user@dev</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/base.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>添加用户及用户组</strong></p><p>默认情况下 <strong>OpenLDAP</strong> 没有普通用户的，但有个管理员用户，即刚配置的 <strong>root</strong></p><p>现在我们把系统中的用户，添加到 <strong>OpenLDAP</strong> 中，为了进行区分，新加两个用户 <strong>ldapuser1</strong> 和 <strong>ldapuser2</strong>，和两个用户组 <strong>ldapgroup1</strong> 和 <strong>ldapgroup2</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">groupadd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapgroup1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">groupadd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapgroup2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>添加用户并设置密码</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">useradd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapgroup1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapuser1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">useradd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapgroup2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapuser2</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;123456&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">passwd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --stdin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapuser1</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;123456&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">passwd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --stdin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapuser2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将 用户 和 用户组提取出来，包括该用户的密码和其他相关属性</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:10[0-9][0-9]&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/passwd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/users</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;:10[0-9][0-9]&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/groups</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>根据上述生成的 用户 和 用户组 属性，使用 <strong>migrate_passwd.pl</strong> 文件生成对应的 <strong>ldif</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/share/migrationtools/migrate_group.pl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/groups</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/groups.ldif</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/share/migrationtools/migrate_passwd.pl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/users</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/users.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导入用户及用户组到OpenLDAP数据库</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;user@dev&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/groups.ldif</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;user@dev&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/users.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>把OpenLDAP用户加入到用户组</strong></p><p>尽管已经把用户和用户组信息，导入到 <strong>OpenLDAP</strong> 数据库中了，但实际上 <strong>用户 和 用户组之间没有任何关联</strong> ，关联需另外单独配置</p><p>把 <strong>ldapuser1</strong> 用户加入到 <strong>ldapgroup1</strong> 用户组，需要新建添加用户到用户组的 <strong>ldif</strong> 文件，如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/add_user_to_groups.ldif</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&quot;EOF&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dn: cn=ldapgroup1,ou=Group,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">changetype: modify</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">add: memberuid</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">memberuid: ldapuser1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dn: cn=ldapgroup2,ou=Group,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">changetype: modify</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">add: memberuid</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">memberuid: ldapuser2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapadd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;user@dev&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/add_user_to_groups.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询测试</strong> 刚才添加的 <strong>OpenLDAP</strong> 用户组信息，如下：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapsearch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -LLL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;user@dev&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=ldapgroup1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cn=ldapgroup1,ou=Group,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectClass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> posixGroup</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectClass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> top</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapgroup1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">userPassword::</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> e2NyeXB0fXg=</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gidNumber:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1002</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">memberUid:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapuser1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-开启-openldap-日志访问" tabindex="-1"><a class="header-anchor" href="#_3-2-开启-openldap-日志访问"><span>3.2 开启 OpenLDAP 日志访问</span></a></h3><p>默认情况下 <strong>OpenLDAP</strong> 未启用日志记录功能，但实际使用过程中，定位问题需要使用 <strong>OpenLDAP</strong> 日志</p><p>新建日志配置 <strong>ldif</strong> 文件，如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/openldap/loglevel.ldif</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dn: cn=config</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">changetype: modify</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">replace: olcLogLevel</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">olcLogLevel: stats</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapmodify</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/openldap/loglevel.ldif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <strong>rsyslog</strong> 配置文件，并重启服务，如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt;&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/rsyslog.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">local4.* /var/log/slapd.log</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rsyslog</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slapd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 <strong>ldapuser1</strong> 认证</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapwhoami</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uid=ldapuser1,ou=People,dc=uit,dc=ldevops,dc=local</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=ldapuser1,ou=People,dc=uit,dc=ldevops,dc=local</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看 <strong>OpenLDAP</strong> 日志</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tail</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/log/slapd.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:24:55</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1006</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fd</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">11</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> closed</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fd</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">11</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ACCEPT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> IP=[::1]:56602</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (IP=[::]:389)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BIND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dn=&quot;uid=ldapuser1,ou=People,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> method=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BIND</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dn=&quot;uid=ldapuser1,ou=People,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mech=SIMPLE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssf=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RESULT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tag=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">97</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> err=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> text=</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> EXT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> oid=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.3.6.1.4.1.4203.1.11.3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> WHOAMI</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RESULT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> oid=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> err=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> text=</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> op</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UNBIND</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nov</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:25:12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [localhost] slapd[30924]: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">conn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1007</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> fd</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">11</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> closed</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-说明" tabindex="-1"><a class="header-anchor" href="#_3-3-说明"><span>3.3 说明</span></a></h3><h4 id="配置-ldif-文件" tabindex="-1"><a class="header-anchor" href="#配置-ldif-文件"><span>配置 LDIF 文件</span></a></h4><p><strong>.ldif</strong> 配置文件，通常用来进行数据添加、初始化等（<em>手动编辑效率低因此通常用上文的工具</em>），文件内容类似如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 假设要创建一个名为 uit.ldevops.local.ldif 的ldif 文件，内容如下</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uit.ldevops.local.ldif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建名为 uit.ldevops.local 的 top根域</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dc=uit,dc=ldevops,dc=local</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 条目标识</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> top</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">						# 对象类型为 顶级 即根</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> domain</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">						# 对象类型为 域</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dcobject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">					</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> organization</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dc:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uit</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">									# 必须定义属性dc</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">o:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uit</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">									# 必须定义属性 o</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建名为 cloud 的组织 ou</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ou=cloud,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ou:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloud</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> organizationalUnit</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# ou 组织</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建名为 admin 的 person 用户</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cn=admin,ou=cloud,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> admin</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> admin</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> person</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">						# person 类型的用户</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建名为 zz 的 person 用户</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cn=zz,ou=cloud,dc=uit,dc=ldevops,dc=local</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">objectclass:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> person</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>dn</strong> 是主键，要唯一，要确保这些数据不能与已有数据相同，否则操作中断</li></ul><p>有了 <strong>.ldif</strong> 文件，就可以将其添加到 <strong>目录数据库</strong>，导入到 <strong>LDAP</strong>，其创建的层级结构，类似如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                 +-------------------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 |  </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">uit,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ldeveops,</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                 +-------------------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                 |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                 v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        +--------+--+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ou</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        +-+------+--+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          |      |</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">          v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      v</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   +------+-+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   ++----+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|   |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">zz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   +--------+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   +-----+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若要添加管理员密码的 <strong>.ldif</strong> 文件</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建 passwd.ldif 如下</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}hdb,cn=config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">changetype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modify</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">replace:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> olcSuffix</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcSuffix:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dc=test,dc=com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}hdb,cn=config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">changetype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modify</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">replace:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> olcRootDN</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcRootDN:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cn=dev3,dc=test,dc=com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> olcDatabase={</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}hdb,cn=config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">changetype:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> modify</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">add:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> olcRootPW</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">olcRootPW:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {SSHA}xvQKJMVV5699d7cIeDYlNhOZKQHwbCyo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行如下命令添加</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapmodify</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXTERNAL</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ldapi:///</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> passwd.ldif</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">	\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-ldap-的-curd-操作" tabindex="-1"><a class="header-anchor" href="#_3-4-ldap-的-curd-操作"><span>3.4 LDAP 的 CURD 操作</span></a></h3>`,63)),k(t,{id:"381",data:[{id:"添加"},{id:"删除"},{id:"修改"},{id:"查询"}]},{title0:l(({value:n,isActive:e})=>a[2]||(a[2]=[i("添加")])),title1:l(({value:n,isActive:e})=>a[3]||(a[3]=[i("删除")])),title2:l(({value:n,isActive:e})=>a[4]||(a[4]=[i("修改")])),title3:l(({value:n,isActive:e})=>a[5]||(a[5]=[i("查询")])),tab0:l(({value:n,isActive:e})=>a[6]||(a[6]=[s("h5",{id:"ldapadd-添加",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ldapadd-添加"},[s("span",null,[s("strong",null,"ldapadd 添加")])])],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 导入 ldap 命令")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapadd"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "DN"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," password"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," idif-file.ldif")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 选项")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -x"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   进行简单认证")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   用来绑定服务器的"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," DN")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -h"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   目录服务的地址")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   绑定"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," DN"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 的密码")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   使用"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldif"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 文件"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 来添加条目")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1)])),tab1:l(({value:n,isActive:e})=>a[7]||(a[7]=[s("h5",{id:"ldapdelete-删除",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ldapdelete-删除"},[s("span",null,[s("strong",null,"ldapdelete 删除")])])],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapdelete"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "DN"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," password"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," idif-file.ldif")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 选项")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -c"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"         连续运行模式"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," (运行出错时跳过继续执行)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," file"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"    指定文件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -M"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"         启用管理DSA"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," IT控制")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -P"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," version"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 协议版本"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"("),s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"default:"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," 3"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},")")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -r"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"         递归删除")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,[i("将 "),s("code",null,"uit.ldeveops.local.ldif"),i(" 编写的数据导入到 "),s("strong",null,"ldap"),i(" 删除示例")],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 删除整个配置文件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapdelete"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "cn=cloud,dc=uit,dc=ldevops,dc=local"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," {SSHA}SsnKledkDHBy6V8vU9kffRvM8GzWZhSx"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," /root/uit.ldeveops.local.ldif")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 删除root用户")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"ldapdelete"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "cn=cloud,dc=uit,dc=ldevops,dc=local"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," {SSHA}SsnKledkDHBy6V8vU9kffRvM8GzWZhSx"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "cn=admin,ou=cloud,dc=uit,dc=ldevops,dc=local"')]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"ldapdelete"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 'cn=cloud,dc=uit,dc=ldevops,dc=local'"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," password"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 'uid=ldapuser1,,ou=People,dc=uit,dc=ldevops,dc=local'")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1)])),tab2:l(({value:n,isActive:e})=>a[8]||(a[8]=[s("h5",{id:"ldapmodify-修改",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ldapmodify-修改"},[s("span",null,[s("strong",null,"ldapmodify 修改")])])],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapmodify"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," DN"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," password"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," modify.ldif")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 选项")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -a"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 添加新的条目.缺省的是修改存在的条目.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -C"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 自动追踪引用.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -c"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 出错后继续执行程序并不中止.缺省情况下出错的立即停止.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," binddn"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 指定搜索的用户名"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},"("),s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"一般为一dn"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 值"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}},")"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},".")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 设置客户端证书文件,例:"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -e"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," cert/client.crt")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -E"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 设置客户端证书私钥文件,例:"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -E"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," cert/client.key")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," file"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 从文件内读取条目的修改信息而不是从标准输入读取.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -H"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapuri"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 指定连接到服务器uri.常见格式为ldap://hostname:port")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -h"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldaphost"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 指定要连接的主机的名称/ip"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 地址.它和-p"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 一起使用.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -p"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapport"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 指定要连接目录服务器的端口号.它和-h"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 一起使用.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -M"),s("span",{style:{"--shiki-light":"#383A42","--shiki-dark":"#ABB2BF"}}," [M] 打开manage DSA IT 控制. -MM 把该控制设置为重要的.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -n"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 用于调试到服务器的通讯.但并不实际执行搜索.服务器关闭时,返回错误；服务器打开时,常和-v"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 参数一起测试到服务器是否是一条通路.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -v"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 运行在详细模块.在标准输出中打出一些比较详细的信息.比如:连接到服务器的ip"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 地址和端口号等.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -V"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 启用证书认证功能,目录服务器使用客户端证书进行身份验证,必须与-ZZ"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 强制启用TLS"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 方式配合使用,并且匿名绑定到目录服务器.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -W"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 指定了该参数,系统将弹出一提示入用户的密码.它和-w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 参数相对使用.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," bindpasswd"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 直接指定用户的密码."),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 它和-W"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 参数相对使用.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -x"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 使用简单认证.")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -Z[Z]"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 使用StartTLS"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 扩展操作.如果使用-ZZ,命令强制使用StartTLS"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 握手成功.")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,"编写文件如下",-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"dn:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," olcDatabase={"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"2"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"}hdb,cn=config")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"changetype:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," modify")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"replace:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," olcSuffix")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"olcSuffix:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," dc=uit,dc=ldevops,dc=local")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"dn:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," olcDatabase={"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"2"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"}hdb,cn=config")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"changetype:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," modify")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"replace:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," olcRootDN")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"olcRootDN:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," cn=root,dc=uit,dc=ldevops,dc=local")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"dn:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," olcDatabase={"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}},"2"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"}hdb,cn=config")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"changetype:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," modify")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"add:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," olcRootPW")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"olcRootPW:"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," {SSHA}SsnKledkDHBy6V8vU9kffRvM8GzWZhSx")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapmodify"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -Y"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," EXTERNAL"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -H"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapi:///"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -f"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," passwd.ldif")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapmodify"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "cn=root,dc=it,dc=com"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -W"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," secret")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"})])],-1)])),tab3:l(({value:n,isActive:e})=>a[9]||(a[9]=[s("h5",{id:"ldapsearch-查询",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ldapsearch-查询"},[s("span",null,[s("strong",null,"ldapsearch 查询")])])],-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapsearch"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -LLL"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," DN"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," password"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -b"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," 根域"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," query_param")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 选项")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -x"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   进行简单认证")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   用来绑定服务器的DN")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   绑定DN的密码")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -b"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   指定要查询的根节点")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"    -H"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},"   制定要查询的服务器")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),s("p",null,"示例如下",-1),s("div",{class:"language-shell line-numbers-mode","data-highlighter":"shiki","data-ext":"shell",style:{"--shiki-light":"#383A42","--shiki-dark":"#abb2bf","--shiki-light-bg":"#FAFAFA","--shiki-dark-bg":"#282c34"}},[s("pre",{class:"shiki shiki-themes one-light one-dark-pro vp-code"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"$"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldapsearch"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -LLL"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -x"),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -D"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "cn=cloud,dc=uit,dc=ldevops,dc=local"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -w"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "user@dev"'),s("span",{style:{"--shiki-light":"#986801","--shiki-dark":"#D19A66"}}," -b"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "dc=uit,dc=ldevops,dc=local"'),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}},' "cn=ldapgroup1"')]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 查询 uit.ldevops.local 域下 cloud 组织的 ldapgroup1 用户组")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#4078F2","--shiki-dark":"#61AFEF"}},"-H"),s("span",{style:{"--shiki-light":"#50A14F","--shiki-dark":"#98C379"}}," ldaps://192.168.10.192:389")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0A1A7","--shiki-light-font-style":"italic","--shiki-dark":"#7F848E","--shiki-dark-font-style":"italic"}},"# 貌似可以远程查询")])])]),s("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1)])),_:1}),a[12]||(a[12]=h(`<h2 id="_4-图形化应用" tabindex="-1"><a class="header-anchor" href="#_4-图形化应用"><span>4. 图形化应用</span></a></h2><h3 id="_4-1-phpldapadmin" tabindex="-1"><a class="header-anchor" href="#_4-1-phpldapadmin"><span>4.1 phpldapadmin</span></a></h3><p><a href="http://phpldapadmin.sourceforge.net/wiki/index.php/Main_Page" target="_blank" rel="noopener noreferrer">phpldapadmin</a> 是用 <strong>php</strong> 开发的 <strong>Web</strong> 应用</p><h4 id="安装-phpldapadmin" tabindex="-1"><a class="header-anchor" href="#安装-phpldapadmin"><span>安装 phpldapadmin</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装红帽衍生库</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> epel-release</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> phpldapadmin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 或是</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enablerepo=epel</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> phpldapadmin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改 php 配置</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/phpldapadmin/config.php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +397</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 397行取消注释，398行添加注释</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$servers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;setValue(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;login&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;attr&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;dn&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">//$servers-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">setValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;login&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;attr&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;uid&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置域名</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$servers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;setValue(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;server&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;base&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,array(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;dc=uit,dc=ldevops,dc=local&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 绑定登录账户，默认填写</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$servers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-&gt;setValue(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;login&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;bind_id&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;uid=ldapuser1,ou=People,dc=uit,dc=ldevops,dc=local&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <strong>httpd</strong> 的 <strong>apache</strong> 配置</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/httpd/conf.d/phpldapadmin.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 改写如下配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#  Web-based tool for managing LDAP servers</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Alias</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /phpldapadmin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/phpldapadmin/htdocs</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Alias</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /ldapadmin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/phpldapadmin/htdocs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;Directory /usr/share/phpldapadmin/htdocs&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IfModule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mod_authz_core.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">c&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Apache 2.4</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Require local</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 还可以添加一行内容，指定可访问的ip段，按需</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Require ip 192.168.77.0/24</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 也可以所有</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Require</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> granted</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/IfModule</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">IfModule</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> !mod_authz_core.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">c&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # Apache 2.2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Order</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Deny,Allow</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Deny</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Allow</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Allow</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ::1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/IfModule</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/Directory&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>重启 httpd 并配置防火墙</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpd.service</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --now</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">firewall-cmd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --permanent</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --zone=public</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --add-service=http</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">firewall-cmd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>浏览器访问 phpldapadmin</strong></p><ul><li><strong>url：</strong> <a href="http://172.16.120.145/phpldapadmin/" target="_blank" rel="noopener noreferrer">http://172.16.120.145/phpldapadmin/</a></li><li><strong>用户名：</strong> 默认上文已经配置，需全称</li><li><strong>密码：</strong> 设定的管理员密码</li></ul><h3 id="_4-2-self-service-password" tabindex="-1"><a class="header-anchor" href="#_4-2-self-service-password"><span>4.2 Self Service Password</span></a></h3><p><a href="https://ltb-project.org/documentation/self-service-password" target="_blank" rel="noopener noreferrer">Self Service Password</a> 是基于 <strong>php</strong> 的 <strong>Web</strong> 应用，用来自助修改密码，解放管理员的工作，让 <strong>OpenLDAP</strong> 用户可自行进行密码的修改和重置，支持标准的 <strong>LDAPv3</strong> 目录服务，包括：<strong>OpenLDAP</strong>、<strong>Active Directory</strong>、<strong>OpenDS</strong>、<strong>ApacheDS</strong> 等</p><p><a href="https://github.com/ltb-project/self-service-password" target="_blank" rel="noopener noreferrer">GItHub</a></p><h4 id="安装-self-service-password" tabindex="-1"><a class="header-anchor" href="#安装-self-service-password"><span>安装 Self Service Password</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/yum.repos.d/ltb-project-noarch.repo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[ltb-project-noarch]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">name=LTB project packages</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">baseurl=https://ltb-project.org/rpm/</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">releasever/noarch</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gpgcheck=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-LTB-project</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rpm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --import</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://ltb-project.org/lib/RPM-GPG-KEY-LTB-project</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> self-service-password</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看 <strong>Self Service Password</strong> 安装的文件，如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rpm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -ql</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> self-service-password</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>/etc/httpd/conf.d/self-service-password.conf： </code> <strong>apache</strong> 配置文件</li><li><code>/usr/share/self-service-password/conf/config.inc.php：</code> <strong>self-service-password</strong> 配置文件</li></ul><p><strong>修改配置文件</strong></p><p>若不用虚拟机，可修改 <strong>apache</strong> 配置文件</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/httpd/conf.d/self-service-password.conf{,.bak}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/httpd/conf.d/self-service-password.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Alias /ssp /usr/local/self-service-password</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&lt;Directory /usr/local/self-service-password&gt;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        AllowOverride None</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &lt;IfVersion &gt;= 2.3&gt;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            Require all granted</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &lt;/IfVersion&gt;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &lt;IfVersion &lt; 2.3&gt;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            Order Deny,Allow</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            Allow from all</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &lt;/IfVersion&gt;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        DirectoryIndex index.php</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        AddDefaultCharset UTF-8</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&lt;/Directory&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <strong>LDAP</strong> 连接和 <strong>email</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  /usr/share/self-service-password/conf/config.inc.php</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +37</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ldap://localhost&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_starttls</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_binddn</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=Manager,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_bindpw</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;user@dev&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_base</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ou=People,dc=uit,dc=ldevops,dc=local&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_login_attribute</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_fullname_attribute</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;(&amp;(objectClass=person)(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$ldap_login_attribute</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">={login}))&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$keyphrase</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;uitRandmon&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SSHA&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$who_change_password</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;manager&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;admin@example.com&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_from_name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Self Service Password&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_signature</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Notify users anytime their password is changed</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$notify_on_change</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = false;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># PHPMailer configuration (see https://github.com/PHPMailer/PHPMailer)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_sendmailpath</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;/usr/sbin/sendmail&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_protocol</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;smtp&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_debug</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_debug_format</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;error_log&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;localhost&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_auth</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_port</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_timeout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_keepalive</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_secure</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;tls&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_smtp_autotls</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_contenttype</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;text/plain&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_wordwrap</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_charset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;utf-8&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_priority</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$mail_newline</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PHP_EOL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>修改ldap的连接信息，<code>$keyphrase</code> 设定一个随机字符串</p></blockquote><p>重启 <strong>apache</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>访问页面</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">http://172.16.120.145/index.php</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>修改密码</p><img src="`+F+`"><p>在终端验证修改的密码</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapwhoami</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uid=ldapuser1,ou=People,dc=lework,dc=com</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldap_bind:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Invalid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> credentials</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (49)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldapwhoami</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uid=ldapuser1,ou=People,dc=lework,dc=com</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -w</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 12345678</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dn:uid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">=ldapuser1,ou=People,dc=lework,dc=com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用邮件找回，或者短信找回</p><h2 id="_5-管理软件" tabindex="-1"><a class="header-anchor" href="#_5-管理软件"><span>5. 管理软件</span></a></h2><h3 id="_5-1-smbldap-tools" tabindex="-1"><a class="header-anchor" href="#_5-1-smbldap-tools"><span>5.1 smbldap-tools</span></a></h3><p>是数据库管理软件，方便进行用户端的管理，但 <strong>smbldap-tools</strong> 有个缺点，不管你本地用户是否有相同的 <strong>UID</strong> 或则 <strong>GID</strong> 都会直接添加用户，故可能会引起冲突</p><blockquote><p><strong>smbldap-tools</strong> 的软件包在 <strong>epel</strong> 库，可能需先安装 <strong>epel</strong> 源（建议在客户端安装，方便初始化</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smbldap-tools</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>smbldap</strong> 会从 <code>/etc/samba/smb.conf</code> 读取部分信息，使用如下命令配置</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smbldap-config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 初始化配置 OPENldap 数据库</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smbldap-populate</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建用户如下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加用户User2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smbldap-useradd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> igarashi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100001</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -a：</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定添加的用户类型为</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Windows，这样</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> samba</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 才能识别到该用户</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    -m：</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 指定创建该用户的家目录</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 修改该用户的密码</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smbldap-passwd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> igarashi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong> 如上方式加入用户，会默认使用客户端的 <strong>SID</strong> ，认证时需确认加入的节点同属于一个 <strong>SID</strong> （<em>服务端修改</em> ）</p></blockquote><h3 id="_5-2-其他-windows-管理工具" tabindex="-1"><a class="header-anchor" href="#_5-2-其他-windows-管理工具"><span>5.2 其他 Windows 管理工具</span></a></h3><ul><li><strong>ldapadmin</strong></li><li><strong>apache Directory Studio</strong></li></ul><h2 id="_6-加域配置" tabindex="-1"><a class="header-anchor" href="#_6-加域配置"><span>6. 加域配置</span></a></h2><p>以上述搭建环境 <strong>uit.ldevops.local</strong> 为例 ，现有目标节点 <strong>172.16.120.141</strong> 待加入域</p><ul><li><strong>ip: 172.16.120.145</strong></li><li><strong>域管理员: cloud</strong></li><li><strong>绑定DN：cn=cloud,dc=uit,dc=ldevops,dc=local</strong></li></ul><p>修改 <strong>Samba</strong> 配置文件</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$ vim /etc/samba/smb.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">[global]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">workgroup</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> UIT</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">netbios </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> node141</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">security</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> user</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">passdb </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">backend</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> ldapsam:ldap://172.16.120.145</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">suffix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;dc=uit,dc=ldevops,dc=local&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap group </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">suffix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=group&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap user </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">suffix</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ou=people&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap admin </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cn=cloud,dc=uit,dc=ldevops,dc=local&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap delete </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">pam password </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">change</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap passwd </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">sync</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldap </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">ssl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># optimization</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">sync </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">always</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">write cache </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 10485760</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">socket </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">options</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> TCP_NODELAY IPTOS_LOWDELAY </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">SO_RCVBUF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">131072 </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">SO_SNDBUF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">131072</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">use </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">sendfile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">min receivefile </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 131072</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># common params</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">log </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> /var/log/samba/%m.log</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">max log </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 50</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">printcap </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> /etc/printcap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">load </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">printers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">wins </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">unix </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">charset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> utf-8</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">dos </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">charset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> cp936</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">dns </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">proxy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">delete </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">readonly</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">create </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">mask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 0777</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">directory </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">mask</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 0777</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">force create </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 0777</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">force directory </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> 0777</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">template </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">shell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> /bin/false</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">map to </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">guest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> bad user</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">null </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">passwords</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">usershare allow </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">guests</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">include</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;"> /etc/samba/smb_shares.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container caution"><p class="hint-container-title">特别注意</p><p><strong>include</strong> 共享文件路径参数，必须放在最后</p></div><p>修改 <strong>nsswitch</strong></p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$ vim /etc/nsswitch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">passwd:        files ldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">shadow:        files ldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">group:         files ldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">hosts:         files dns ldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">bootparams:    files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ethers:        files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">networks:      files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">protocols:     files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">rpc:           files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">services:      files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">netgroup:      files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">publickey:     files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">automount:     files</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">aliases:       files</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <strong>nslcd</strong></p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$ vim /etc/nslcd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">uid nslcd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">gid ldap</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">uri ldap://172.16.120.145/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">base </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">uit,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldevops,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">local</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ssl no</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">binddn </span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">cn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">cloud,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">uit,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">ldevops,</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">dc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">local</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">bindpw user@dev</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">filter passwd (</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">objectclass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">*)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">filter shadow (</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">objectclass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">*)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">filter group  (</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">objectclass</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">*)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改 <strong>hosts</strong></p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">$ vim /etc/hosts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">172.16.120.145 uit.ldevops.local</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加域验证操作</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启一系列服务</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nmb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nslcd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启成功此时应该可以列出域用户</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> getent</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> passwd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 若有问题，先查看 Samba 配置文件是否正确</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> testparm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 验证 Samba DB 是否能显示域用户的 SID</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pdbedit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -L</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">igarashi:1000001:igarashi</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jackson:150001:jackson</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sasaki:100002:sasaki</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">jack:200041:jack</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> S-1-5-21-336872314-1070286693-535668972-1001</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> does</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> belong</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> our</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> domain</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">最后一个</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sid 则表示非域内用户，若Samba访问会显示 安全ID 结构无效，解决方式参考如下\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>成功加入域的检测方式：</strong> 上述步骤正确，服务正常，且在 <strong>ldap</strong> 服务端可以查看到加入节点的域名，则表示成功（<em>加入域后，服务端会自动注册节点的 <strong>hostname</strong> 信息</em> ）</p><img src="`+u+'"><div class="hint-container info"><p class="hint-container-title">注意</p><p>若连接多个域，可能需要在服务端将每个节点自动生成的 <strong>SID</strong> 都改为域用户一致的 <strong>SID</strong>（<em>可用上述工具 <strong>smbldap-tool</strong> 方便的生成域用户</em> ）</p><p>若用户有（<em>不在服务端改写数据</em>）的需求，获取考虑获取域用户的 <strong>SID</strong>，然后重新对加域节点的 <strong>SID</strong> 进行改写一致操作，这一开始也许是为了多个域的不同域用户而设计的，实际需根据客户现场环境考虑</p></div>',65))])}const E=p(v,[["render",b]]),D=JSON.parse('{"path":"/unix/CentOS/LDAP/LDAP.html","title":"LDAP","lang":"zh-CN","frontmatter":{"title":"LDAP","date":"2022-09-22T00:00:00.000Z","category":["运维"],"tag":["Linux","LDAP","认证"],"star":true,"description":"DAP（Directry Access Protocol）： 即目录访问协议，较老、复杂且重量级，后面又出轻量级、更好用的 LDAP","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"LDAP\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-09-22T00:00:00.000Z\\",\\"dateModified\\":\\"2022-12-14T04:33:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"悦·宝宝\\",\\"url\\":\\"https://github.com/Igarashi-G\\"}]}"],["meta",{"property":"og:url","content":"https://igarashi-g.github.io/unix/CentOS/LDAP/LDAP.html"}],["meta",{"property":"og:site_name","content":"悦 ▪ 宝宝"}],["meta",{"property":"og:title","content":"LDAP"}],["meta",{"property":"og:description","content":"DAP（Directry Access Protocol）： 即目录访问协议，较老、复杂且重量级，后面又出轻量级、更好用的 LDAP"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-12-14T04:33:36.000Z"}],["meta",{"property":"article:tag","content":"认证"}],["meta",{"property":"article:tag","content":"LDAP"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2022-09-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2022-12-14T04:33:36.000Z"}]]},"git":{"createdTime":1664462137000,"updatedTime":1670992416000,"contributors":[{"name":"Igarashi","username":"Igarashi","email":"2545369032@qq.com","commits":8,"url":"https://github.com/Igarashi"}]},"readingTime":{"minutes":16.78,"words":5035},"filePathRelative":"unix/CentOS/LDAP/LDAP.md","excerpt":"\\n<p><strong>DAP（Directry Access Protocol）：</strong> 即目录访问协议，较老、复杂且重量级，后面又出轻量级、更好用的 <strong>LDAP</strong></p>\\n","autoDesc":true}');export{E as comp,D as data};
