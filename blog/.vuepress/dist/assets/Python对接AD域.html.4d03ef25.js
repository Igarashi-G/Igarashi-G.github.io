import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as p,c as o,e as c,a as n,b as i,d as s,f as a,r as l}from"./app.1ee68d9c.js";const u={},r=n("p",null,[n("strong",null,"UFS"),s(" \u7BA1\u7406\u5E73\u53F0 \u901A\u8FC7"),n("strong",null,"ldap3"),s(" \u5BF9\u63A5 "),n("strong",null,"AD"),s(" \u57DF\uFF0C\u52A0\u5165\u57DF\u3001\u9000\u51FA\u57DF\u3001"),n("strong",null,"CIFS"),s(" \u6743\u9650\u8BA4\u8BC1\u7B49")],-1),d=a('<h1 id="python-\u5BF9\u63A5ad\u57DF" tabindex="-1"><a class="header-anchor" href="#python-\u5BF9\u63A5ad\u57DF" aria-hidden="true">#</a> Python \u5BF9\u63A5AD\u57DF</h1><h2 id="_1-\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#_1-\u9700\u6C42" aria-hidden="true">#</a> 1. \u9700\u6C42</h2><h2 id="_2-ldap3" tabindex="-1"><a class="header-anchor" href="#_2-ldap3" aria-hidden="true">#</a> 2. ldap3</h2>',3),k=n("strong",null,"pip",-1),v=s(" \u5B89\u88C5 "),m={href:"https://ldap3.readthedocs.io/en/latest/welcome.html",target:"_blank",rel:"noopener noreferrer"},b=s("ldap3"),h=s(" \u5E93"),g=a(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ pip Install ldap3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7B80\u5355\u5EFA\u7ACB\u540C\u6B65\u8FDE\u63A5</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> ldap3 <span class="token keyword">import</span> Server<span class="token punctuation">,</span> Connection<span class="token punctuation">,</span> ALL

server <span class="token operator">=</span> Server<span class="token punctuation">(</span><span class="token string">&quot;uit.devops.local&quot;</span><span class="token punctuation">,</span> get_info<span class="token operator">=</span>ALL<span class="token punctuation">)</span>	<span class="token comment"># Windows \u642D\u5EFA\u7684AD Server \u57DF\u540D</span>
conn <span class="token operator">=</span> Connection<span class="token punctuation">(</span>server<span class="token punctuation">,</span> auto_bind<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">)</span>

ret <span class="token operator">=</span> conn<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>standard<span class="token punctuation">.</span>who_am_i<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;who_am_i&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># who_am_i None</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>LDAP</strong> \u5141\u8BB8\u65E0\u9700\u8BA4\u8BC1\u7684\u533F\u540D\u767B\u5165\uFF0C\u56E0\u4E3A <strong>DAP</strong> \u534F\u8BAE\u6700\u65E9\u662F\u8BFB\u53D6\u7535\u8BDD\u7C3F\u7684\uFF0C\u4EFB\u4F55\u4EBA\u90FD\u53EF\u4EE5\u9605\u8BFB\uFF08<em>\u4F46\u5185\u5BB9\u4E0A\u4F1A\u90E8\u5206\u53D7\u9650</em>\uFF09\uFF0C\u4F46\u82E5\u5EFA\u7ACB\u8EAB\u4EFD\u8BA4\u8BC1\u7684\u4F1A\u8BDD\uFF0C\u5C31\u9700\u8981 <strong>DN</strong> \u548C <strong>\u5BC6\u7801</strong></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> ldap3 <span class="token keyword">import</span> Server<span class="token punctuation">,</span> Connection<span class="token punctuation">,</span> ALL

server <span class="token operator">=</span> Server<span class="token punctuation">(</span><span class="token string">&quot;uit.devops.local&quot;</span><span class="token punctuation">,</span> get_info<span class="token operator">=</span>ALL<span class="token punctuation">)</span>
<span class="token comment"># conn = Connection(server, user=&quot;zhengze&quot;, password=&quot;user@dev&quot;, auto_bind=True) # \u6216\u4F7F\u7528 DN</span>
conn <span class="token operator">=</span> Connection<span class="token punctuation">(</span>server<span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">&#39;cn=zhengze,cn=Users,dc=uit,dc=devops,dc=local&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;user@dev&#39;</span><span class="token punctuation">,</span> auto_bind<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

ret <span class="token operator">=</span> conn<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>standard<span class="token punctuation">.</span>who_am_i<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>

<span class="token comment"># u:UIT\\zhengze</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1-\u67E5\u8BE2" tabindex="-1"><a class="header-anchor" href="#_2-1-\u67E5\u8BE2" aria-hidden="true">#</a> 2.1 \u67E5\u8BE2</h3><p>\u53EF\u4F7F\u7528 <strong>\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668</strong> \u81EA\u52A8\u7ED1\u5B9A\uFF0C\u67E5\u8BE2\u64CD\u4F5C\u5982\u4E0B</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">with</span> Connection<span class="token punctuation">(</span>server<span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">&#39;cn=zhengze,cn=Users,dc=uit,dc=devops,dc=local&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;user@dev&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>standard<span class="token punctuation">.</span>who_am_i<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">&#39;dc=uit,dc=devops,dc=local&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;(objectclass=user)&#39;</span><span class="token punctuation">,</span>
                attributes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;cn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UserAccountControl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>entries<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>entries<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>entry_to_json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528 <strong>search()</strong> \u67E5\u8BE2\uFF0C\u652F\u6301\u751F\u6210\u5668\u65B9\u5F0F\u5982\u4E0B</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">search_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Connection<span class="token punctuation">(</span>server<span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">&#39;cn=zhengze,cn=Users,dc=uit,dc=devops,dc=local&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;user@dev&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
        entry_generator <span class="token operator">=</span> conn<span class="token punctuation">.</span>extend<span class="token punctuation">.</span>standard<span class="token punctuation">.</span>paged_search<span class="token punctuation">(</span>
            search_base<span class="token operator">=</span><span class="token string">&quot;dc=uit,dc=devops,dc=local&quot;</span><span class="token punctuation">,</span>
            search_filter<span class="token operator">=</span><span class="token string">&#39;(objectClass=user)&#39;</span><span class="token punctuation">,</span>
            search_scope<span class="token operator">=</span>SUBTREE<span class="token punctuation">,</span>
            attributes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;cn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mail&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;description&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UserAccountControl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            paged_size<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>
            generator<span class="token operator">=</span><span class="token boolean">True</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">for</span> entry <span class="token keyword">in</span> entry_generator<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;attributes&quot;</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">yield</span> entry<span class="token punctuation">[</span><span class="token string">&#39;attributes&#39;</span><span class="token punctuation">]</span>


users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
entry <span class="token operator">=</span> search_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        users<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-\u589E\u52A0" tabindex="-1"><a class="header-anchor" href="#_2-2-\u589E\u52A0" aria-hidden="true">#</a> 2.2 \u589E\u52A0</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,12);function _(y,w){const t=l("ExternalLinkIcon");return p(),o("div",null,[r,c(" more "),d,n("p",null,[k,v,n("a",m,[b,i(t)]),h]),g])}const q=e(u,[["render",_],["__file","Python\u5BF9\u63A5AD\u57DF.html.vue"]]);export{q as default};
