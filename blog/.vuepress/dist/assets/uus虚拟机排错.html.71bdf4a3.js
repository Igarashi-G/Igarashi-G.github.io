import{_ as e}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as a,c as i,e as l,a as s,d as n,f as r}from"./app.69d5dce7.js";const d={},t=s("p",null,[n("\u865A\u62DF\u673A\u73AF\u5883\u4E0B\u4F7F\u7528 "),s("strong",null,"UUS"),n(" \u6392\u9519\u53CA\u8BF4\u660E")],-1),c=r(`<h3 id="_1-uus-\u90E8\u5206\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_1-uus-\u90E8\u5206\u8BF4\u660E" aria-hidden="true">#</a> 1. UUS \u90E8\u5206\u8BF4\u660E</h3><p>\u8FD9\u91CC N\uFF1AM \u662F uraid \u5185\u6570\u636E chunk \u548C\u6821\u9A8C chunk \u7684\u6BD4\u4F8B\u3002 K \u662F URAID \u5BF9\u8282\u70B9\u5931\u6548\u5BB9\u5FCD\u5EA6\u7684\u8981\u6C42\u3002K \u4E0D\u80FD\u5927\u4E8E M\uFF0C\u901A\u5E38\u9009\u62E9\u662F K=0\u30011\u3001M\u3002 K \u9009 0 \u610F\u5473\u7740\u6709\u4EFB\u610F\u8282\u70B9\u5931\u6548\u65F6\uFF0Curaid \u5C06\u4E0D\u53EF\u8BBF\u95EE\uFF0C\u5982\u679C\u8282\u70B9\u4E0D\u80FD\u6062\u590D\u6216\u4FEE\u590D\uFF0C\u5219\u8BE5 uraid \u6570\u636E\u5C06\u4E22\u5931\u3002 K \u9009 1 \u610F\u5473\u7740\u540C\u65F6\u6709\u4E14\u4EC5\u6709\u4E00\u4E2A\u8282\u70B9\u5931\u6548\u65F6\uFF0Curaid \u6570\u636E\u4ECD\u53EF\u6B63\u5E38\u8BFB\u5199\uFF1B\u591A\u4E8E\u4E00\u4E2A\u8282\u70B9 \u540C\u65F6\u5931\u6548\u65F6\uFF0C\u60C5\u51B5\u540C\u4E0A\u3002 K \u9009 M \u610F\u5473\u7740 uraid \u53EF\u4EE5\u63A5\u53D7\u81F3\u591A M \u5404\u8282\u70B9\u540C\u65F6\u5931\u6548\uFF0C\u6570\u636E\u8BFB\u5199\u80FD\u6B63\u5E38\u8FDB\u884C\uFF1B\u591A\u4E8E M \u4E2A\u8282\u70B9\u540C\u65F6\u5931\u6548\u65F6\uFF0C\u60C5\u51B5\u540C\u4E0A\u3002</p><p>K \u7684\u9009\u62E9\u8FD8\u53D7\u5230\u96C6\u7FA4\u5185\u8282\u70B9\u6570\u91CF\u7684\u9650\u5236\uFF0C\u5982\u679C\u8282\u70B9\u6570\u91CF\u5C0F\u4E8E\uFF08N+M\uFF09\uFF0C\u90A3\u4E48\u901A\u5E38\u53EA\u80FD\u9009 \u62E9 0\uFF1B\u5426\u5219\u53EF\u4EE5\u9009 M\uFF0C\u56E0\u6B64\uFF0C\u5B9E\u9645\u90E8\u7F72\u65F6\uFF0C\u901A\u5E38\u96C6\u7FA4\u7684\u8282\u70B9\u6570\u91CF\u5E94\u8BE5\u5927\u4E8E N+M\uFF0C\u5982 N+M+1 \u6216\u66F4\u591A\u3002</p><ul><li><p>\u521B\u5EFA\u5355\u4E2A uraid \u7684\u4F8B\u5B50: &#39;</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ ucli uraid create test-pool test_uraid_1 4000G <span class="token number">256</span> <span class="token number">8</span> <span class="token number">2</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>CAPACITY</strong> \u9ED8\u8BA4\u662F\u6574\u578B\uFF0C\u82E5\u8F93\u5165\u6D6E\u70B9\u578B\uFF0C\u5219\u76F4\u63A5\u53D6\u6574</li><li><strong>URAID-NAME</strong> \u8BBE\u5B9A\u4E3A <code>RANDOM</code> \u65F6\uFF0C\u7CFB\u7EDF\u4F1A\u968F\u673A\u9009\u62E9\u4E00\u4E2A\u547D\u540D\uFF0C\u5728\u811A\u672C\u4E2D\u53CD \u590D\u521B\u5EFA\u591A\u4E2A <code>uraid</code> \u65F6\uFF0C\u53EF\u4EE5\u5229\u7528\u8FD9\u4E2A\u7279\u6027</li></ul></li></ul><p><strong>URAID</strong> \u521B\u5EFA\u540E\uFF0C\u8282\u70B9\u4E2D\u4F1A\u6709\u5BF9\u5E94\u7684 <code>/dev/mdX</code> \u8BBE\u5907 ( <code>X</code> \u5BF9\u5E94 <code>uraid</code> \u7684 <strong>ID</strong>\uFF0C\u96C6\u7FA4\u5185\u552F\u4E00\uFF09\u53EF\u4EE5\u7ACB\u5373\u4F7F\u7528</p><blockquote><p><strong>TIPS</strong>\uFF1A</p><ul><li><p>\u8D44\u6E90\u6C60\u6700\u5C0F\u78C1\u76D8\u6570\u91CF\u662F <code>N + M</code> \uFF0C\u8D44\u6E90\u6C60\u7684\u6700\u5C0F\u8282\u70B9\u6570\u91CF\u662F<code>((N + M) * K / M\uFF09</code></p><ul><li><p>\u5F53 <strong>K</strong> \u662F 0 \u65F6\uFF0C\u9700\u8981\u4E00\u4E2A\u8282\u70B9\u5373\u53EF</p></li><li><p><strong>K</strong> \u4E3A 65000 \u65F6\uFF0C\u5219\u7B97\u6CD5\u53EA\u9009\u62E9\u8D44\u6E90\u6C60\u5185\u672C\u8282\u70B9\u7684\u78C1\u76D8\uFF0C\u8FD9\u610F\u5473\u7740\u672C\u8282\u70B9\u79BB\u7EBF\u540E\uFF0C\u8BE5 <code>uraid</code> \u65E0\u6CD5\u88AB\u5176\u5B83\u8282\u70B9\u63A5\u7BA1\u3002</p></li></ul></li><li><p>\u4F7F\u7528\u4E2D\u6587\u540D\u79F0\u521B\u5EFA uraid \u4E5F\u662F\u652F\u6301\u7684\uFF0C\u4F46\u9700\u8981\u7EC8\u7AEF\u4F7F\u7528 utf-8 \u7F16\u7801\uFF0C\u5426\u5219\u521B\u5EFA\u53EF UUS \u865A\u62DF\u673A\u4F7F\u7528\u53C2\u8003\u6307\u5357</p></li></ul></blockquote><h3 id="_2-\u4F7F\u7528-uus-\u865A\u62DF\u673A\u7684\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_2-\u4F7F\u7528-uus-\u865A\u62DF\u673A\u7684\u9650\u5236" aria-hidden="true">#</a> 2. \u4F7F\u7528 UUS \u865A\u62DF\u673A\u7684\u9650\u5236</h3><h5 id="_2-1-\u4E0D\u4F7F\u7528-uus" tabindex="-1"><a class="header-anchor" href="#_2-1-\u4E0D\u4F7F\u7528-uus" aria-hidden="true">#</a> 2. -1 \u4E0D\u4F7F\u7528 UUS\uFF1A</h5><blockquote><p>\u65E2\u7136\u4E0D\u597D\u7528\uFF0C\u4E3A\u4EC0\u4E48\u8981\u7528\u5462\uFF1F\u6240\u4EE5\u5378\u8F7D\uFF01\uFF01</p></blockquote><ul><li><p><strong>\u5378\u8F7D\u547D\u4EE4</strong>\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u5E72\u6389\u670D\u52A1</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">\`</span><span class="token function">ls</span> /usr/lib/uraid/scripts/init/<span class="token variable">\`</span></span><span class="token punctuation">;</span><span class="token keyword">do</span> systemctl disable <span class="token parameter variable">--now</span> <span class="token variable">$i</span><span class="token punctuation">;</span><span class="token keyword">done</span>

<span class="token comment"># \u5E72\u6389uraid</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/lib/uraid<span class="token punctuation">;</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/sysconfig/uraid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><p>\u7531\u4E8E <strong>uus</strong> \u5728\u865A\u62DF\u673A\u4E0A\u8FD0\u884C\u6709\u8BF8\u591A\u7684\u9650\u5236\uFF0C\u5728\u6B64\u5C06 <strong>uus</strong> \u865A\u62DF\u673A\u7684\u9650\u5236\u5728\u6B64\u5217\u51FA\uFF1A</p><h5 id="_2-1-serial-number" tabindex="-1"><a class="header-anchor" href="#_2-1-serial-number" aria-hidden="true">#</a> 2.1 serial number</h5><ul><li><p>\u865A\u62DF\u7684\u78C1\u76D8\u5FC5\u987B\u6709 <strong>serial number</strong>\uFF0C\u5426\u5219 <strong>uus</strong> \u65E0\u6CD5\u8BC6\u522B\uFF1A</p><ul><li><p>\u91CD\u65B0\u751F\u6210 <code>uuid</code> (<em>\u865A\u62DF\u673A\u514B\u9686\u6A21\u5F0F</em>)</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>uuidgen <span class="token operator">&gt;</span> /etc/machine-id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ul><h5 id="_2-2-\u8D44\u6E90\u5360\u7528" tabindex="-1"><a class="header-anchor" href="#_2-2-\u8D44\u6E90\u5360\u7528" aria-hidden="true">#</a> 2.2 \u8D44\u6E90\u5360\u7528</h5><ul><li><p>\u964D\u4F4E uus \u8D44\u6E90\u5360\u7528(\u865A\u62DF\u673A)</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /usr/lib/systemd/system/unfs-server.service  +32
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/nfsd <span class="token parameter variable">-V</span> <span class="token number">3</span> <span class="token parameter variable">-p</span> <span class="token number">3000</span> <span class="token number">3500</span> \u628A3500\u6539\u5C0F\u70B9 \uFF083000\uFF0C3500\uFF09\u90FD\u653910

systemctl daemon-reload
systemctl stop unfs-server
systemctl start unfs-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u5173\u95ED\u78C1\u76D8\u68C0\u6D4B\uFF08\u865A\u62DF\u673A\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">touch</span> /etc/sysconfig/uraid/disable-exp-chk-baddisk
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/sysconfig/uraid/enable-disk-check
<span class="token function">touch</span> /etc/sysconfig/uraid/enable-uvol-vm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u505C\u6389\u6240\u6709 uus \u670D\u52A1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ ucli svc stop all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h5 id="_2-3-\u8BB8\u53EF" tabindex="-1"><a class="header-anchor" href="#_2-3-\u8BB8\u53EF" aria-hidden="true">#</a> 2.3 \u8BB8\u53EF</h5><ul><li><p>\u5220\u9664 <strong>sn</strong>\uFF0C\u91CD\u65B0\u751F\u6210\u65B0\u7684 <strong>sn</strong>(<em>\u865A\u62DF\u673A</em>)</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/sysconfig/uraid/sn
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/sysconfig/uraid/key
systemctl restart v-meta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u83B7\u53D6 <strong>key</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1.smb\u5171\u4EAB \\\\172.18.50.50\\lic \u76EE\u5F55\u4E0B</span>
username: sn password: sn

<span class="token comment"># 2.\u83B7\u53D6\u8282\u70B9\u7684sn\u53F7</span>
/etc/sysconfig/uraid/sn

<span class="token comment"># 3.\u5C06sn\u53F7\u91CD\u547D\u540D\u4E3Asn+ip\u7684\u5F62\u5F0F\uFF0C\u4E0A\u4F20\u81F3\u6307\u5B9A\u76EE\u5F55</span>

<span class="token comment"># 4.\u76EE\u5F55\u68C0\u6D4B\u5230\u6587\u4EF6\u53D8\u52A8\u540E\u81EA\u52A8\u751F\u6210\u6587\u4EF6\u540D\u4E3Akey....sn+ip \u7684key\u6587\u4EF6\uFF0C\u7136\u540E\u4E0A\u4F20\u81F3\u5982\u4E0B\u8DEF\u5F84</span>
/etc/sysconfig/uraid/key

<span class="token comment"># 5.\u91CD\u542Fv-meta\u670D\u52A1</span>
$ systemctl restart v-meta

<span class="token comment">### \u5176\u4ED6\u8282\u70B9\u91CD\u590D\u4E0A\u8FF0\u6B65\u9AA4</span>

<span class="token comment"># 6.\u68C0\u6D4Bkey\u6587\u4EF6\u662F\u5426\u751F\u6548</span>
$ ucli sysconfig license-show
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u66F4\u65B0 <code>uraid</code> \u7684 <code>udev</code> \u6587\u4EF6\uFF08<strong>1202</strong> \u7248\u672C\u5DF2\u66F4\u65B0\uFF09</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/udev/rules.d/90-umd.rules</span>

SUBSYSTEM!=&quot;block&quot;, GOTO=&quot;umd_end&quot;

# handle umd arrays
KERNEL!=&quot;umd_d*&quot;, GOTO=&quot;umd_end&quot;

#IMPORT{program}=&quot;/sbin/blkid -o udev -p %N&quot;
IMPORT{builtin}=&quot;blkid&quot;
OPTIONS+=&quot;link_priority=100&quot;
OPTIONS+=&quot;watch&quot;
ENV{ID_FS_USAGE}==&quot;filesystem|other|crypto&quot;, ENV{ID_FS_UUID_ENC}==&quot;?*&quot;, SYMLINK+=&quot;disk/by-uuid/<span class="token variable">$env</span>{ID_FS_UUID_ENC}&quot;
ENV{ID_FS_USAGE}==&quot;filesystem|other&quot;, ENV{ID_FS_LABEL_ENC}==&quot;?*&quot;, SYMLINK+=&quot;disk/by-label/<span class="token variable">$env</span>{ID_FS_LABEL_ENC}&quot;

LABEL=&quot;umd_end&quot;

EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_2-4-\u7CFB\u7EDF\u76D8\u6587\u4EF6\u7CFB\u7EDF\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_2-4-\u7CFB\u7EDF\u76D8\u6587\u4EF6\u7CFB\u7EDF\u9650\u5236" aria-hidden="true">#</a> 2.4 \u7CFB\u7EDF\u76D8\u6587\u4EF6\u7CFB\u7EDF\u9650\u5236</h5><ul><li><p>\u5F53\u7CFB\u7EDF\u76D8\u4E3A xfs \u6587\u4EF6\u7CFB\u7EDF\u65F6\uFF0C\u6DFB\u52A0\u6307\u5B9A\u884C <code>return 0</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span>  /usr/lib/uraid/scripts/drivers.shell +174

<span class="token number">171</span>         <span class="token comment">#insmod openfile-by-ino drivers</span>
<span class="token number">172</span>         modprobe xfs
<span class="token number">173</span>         modprobe nfs
<span class="token number">174</span>         insmod /usr/lib/uraid/drivers/u_getpath.ko
<span class="token builtin class-name">return</span> <span class="token number">0</span>
<span class="token number">175</span>         <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token number">0</span> <span class="token parameter variable">-eq</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>lsmod <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;^u_getpath&#39;</span><span class="token variable">)</span></span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token number">176</span>                 eecho <span class="token string">&quot;Setup u_getpath driver FAIL.&quot;</span>
<span class="token number">177</span>                 <span class="token builtin class-name">return</span> <span class="token number">1</span>
<span class="token number">178</span>         <span class="token keyword">fi</span>


systemctl start uraid-driver
systemctl restart v-meta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul>`,20);function u(o,p){return a(),i("div",null,[t,l(" more "),c])}const b=e(d,[["render",u],["__file","uus\u865A\u62DF\u673A\u6392\u9519.html.vue"]]);export{b as default};
